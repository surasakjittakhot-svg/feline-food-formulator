import React, { useMemo, useState } from "react";
import { BarChart3, Settings2, Calculator, Plus, Trash2, FileSpreadsheet, Edit3, Info, ChevronDown } from "lucide-react";

// FEDIAF 2024 Nutritional Requirements for Cats - COMPLETE VERSION
const FEDIAF_CAT_2024 = {
  per100gDM: {
    Protein: { adult: 33.3, growth: 28.0, repro: 30.0, unit: "g" },
    Fat: { adult: 9.0, growth: 9.0, repro: 9.0, unit: "g" },
    "Linoleic acid (ω-6)": { adult: 0.67, growth: 0.55, repro: 0.55, unit: "g" },
    "Arachidonic acid (ω-6)": { adult: 0.008, growth: 0.020, repro: 0.020, unit: "g" },
    "Alpha-linolenic acid (ω-3)": { adult: 0.0, growth: 0.02, repro: 0.02, unit: "g" },
    "EPA+DHA (ω-3)": { adult: 0.0, growth: 0.01, repro: 0.01, unit: "g" },
    Arginine: { adult: 1.30, growth: 1.07, repro: 1.11, unit: "g" },
    Histidine: { adult: 0.33, growth: 0.31, repro: 0.31, unit: "g" },
    Isoleucine: { adult: 0.52, growth: 0.45, repro: 0.46, unit: "g" },
    Leucine: { adult: 1.29, growth: 1.20, repro: 1.20, unit: "g" },
    Lysine: { adult: 0.45, growth: 0.85, repro: 0.85, unit: "g" },
    Methionine: { adult: 0.23, growth: 0.44, repro: 0.44, unit: "g" },
    "Methionine + Cystine": { adult: 0.45, growth: 0.88, repro: 0.88, unit: "g" },
    Phenylalanine: { adult: 0.52, growth: 0.42, repro: 0.43, unit: "g" },
    "Phenylalanine + Tyrosine": { adult: 1.04, growth: 0.88, repro: 0.88, unit: "g" },
    Threonine: { adult: 0.73, growth: 0.65, repro: 0.65, unit: "g" },
    Tryptophan: { adult: 0.17, growth: 0.16, repro: 0.16, unit: "g" },
    Valine: { adult: 0.68, growth: 0.62, repro: 0.62, unit: "g" },
    Taurine: { adult: 0.13, growth: 0.13, repro: 0.13, unit: "g", note: "Dry diets. Wet: 0.27 g/100g DM" },
    Calcium: { adult: 0.53, growth: 1.00, repro: 1.00, unit: "g" },
    Phosphorus: { adult: 0.35, growth: 0.84, repro: 0.84, unit: "g" },
    Potassium: { adult: 0.80, growth: 0.60, repro: 0.60, unit: "g" },
    Sodium: { adult: 0.10, growth: 0.16, repro: 0.16, unit: "g" },
    Chloride: { adult: 0.15, growth: 0.24, repro: 0.24, unit: "g" },
    Magnesium: { adult: 0.05, growth: 0.05, repro: 0.05, unit: "g" },
    Zinc: { adult: 10.0, growth: 7.5, repro: 7.5, unit: "mg" },
    Iron: { adult: 10.7, growth: 8.0, repro: 8.0, unit: "mg" },
    Copper: { adult: 0.67, growth: 1.0, repro: 1.0, unit: "mg" },
    Iodine: { adult: 0.17, growth: 0.18, repro: 0.18, unit: "mg" },
    Manganese: { adult: 0.67, growth: 1.0, repro: 1.0, unit: "mg" },
    Selenium: { adult: 0.028, growth: 0.030, repro: 0.030, unit: "mg" },
    "Vitamin A": { adult: 444, growth: 900, repro: 900, unit: "IU" },
    "Vitamin D": { adult: 33.3, growth: 28.0, repro: 28.0, unit: "IU" },
    "Vitamin E": { adult: 5.07, growth: 3.8, repro: 3.8, unit: "IU" },
    Thiamine: { adult: 0.59, growth: 0.55, repro: 0.55, unit: "mg" },
    Riboflavin: { adult: 0.42, growth: 0.32, repro: 0.32, unit: "mg" },
    Niacin: { adult: 4.21, growth: 3.2, repro: 3.2, unit: "mg" },
    Pantothenic: { adult: 0.77, growth: 0.57, repro: 0.57, unit: "mg" },
    Pyridoxine: { adult: 0.33, growth: 0.25, repro: 0.25, unit: "mg" },
    Biotin: { adult: 8.0, growth: 7.0, repro: 7.0, unit: "µg" },
    Folate: { adult: 101, growth: 75, repro: 75, unit: "µg" },
    Cobalamin: { adult: 2.35, growth: 1.80, repro: 1.80, unit: "µg" },
    Choline: { adult: 320, growth: 240, repro: 240, unit: "mg" },
  },
  per1000kcal: {
    Protein: { adult: 83.3, growth: 70.0, repro: 75.0, unit: "g" },
    Fat: { adult: 22.5, growth: 22.5, repro: 22.5, unit: "g" },
    "Linoleic acid (ω-6)": { adult: 1.67, growth: 1.38, repro: 1.38, unit: "g" },
    "Arachidonic acid (ω-6)": { adult: 0.020, growth: 0.050, repro: 0.050, unit: "g" },
    "Alpha-linolenic acid (ω-3)": { adult: 0.0, growth: 0.05, repro: 0.05, unit: "g" },
    "EPA+DHA (ω-3)": { adult: 0.0, growth: 0.03, repro: 0.03, unit: "g" },
    Arginine: { adult: 3.30, growth: 2.68, repro: 2.78, unit: "g" },
    Histidine: { adult: 0.83, growth: 0.78, repro: 0.78, unit: "g" },
    Isoleucine: { adult: 1.30, growth: 1.13, repro: 1.15, unit: "g" },
    Leucine: { adult: 3.23, growth: 3.00, repro: 3.00, unit: "g" },
    Lysine: { adult: 1.13, growth: 2.13, repro: 2.13, unit: "g" },
    Methionine: { adult: 0.57, growth: 1.10, repro: 1.10, unit: "g" },
    "Methionine + Cystine": { adult: 1.13, growth: 2.20, repro: 2.20, unit: "g" },
    Phenylalanine: { adult: 1.30, growth: 1.05, repro: 1.08, unit: "g" },
    "Phenylalanine + Tyrosine": { adult: 2.60, growth: 2.20, repro: 2.20, unit: "g" },
    Threonine: { adult: 1.83, growth: 1.63, repro: 1.63, unit: "g" },
    Tryptophan: { adult: 0.44, growth: 0.40, repro: 0.40, unit: "g" },
    Valine: { adult: 1.70, growth: 1.55, repro: 1.55, unit: "g" },
    Taurine: { adult: 0.33, growth: 0.33, repro: 0.33, unit: "g", note: "Dry diets. Wet: 0.67 g/1000 kcal" },
    Calcium: { adult: 1.33, growth: 2.50, repro: 2.50, unit: "g" },
    Phosphorus: { adult: 0.85, growth: 2.10, repro: 2.10, unit: "g" },
    Potassium: { adult: 2.0, growth: 1.5, repro: 1.5, unit: "g" },
    Sodium: { adult: 0.25, growth: 0.40, repro: 0.40, unit: "g" },
    Chloride: { adult: 0.39, growth: 0.60, repro: 0.60, unit: "g" },
    Magnesium: { adult: 0.13, growth: 0.13, repro: 0.13, unit: "g" },
    Zinc: { adult: 25, growth: 18.8, repro: 18.8, unit: "mg" },
    Iron: { adult: 26.7, growth: 20.0, repro: 20.0, unit: "mg" },
    Copper: { adult: 1.67, growth: 2.5, repro: 2.5, unit: "mg" },
    Iodine: { adult: 0.43, growth: 0.45, repro: 0.45, unit: "mg" },
    Manganese: { adult: 1.67, growth: 2.5, repro: 2.5, unit: "mg" },
    Selenium: { adult: 0.070, growth: 0.075, repro: 0.075, unit: "mg" },
    "Vitamin A": { adult: 1110, growth: 2250, repro: 2250, unit: "IU" },
    "Vitamin D": { adult: 83.3, growth: 70.0, repro: 70.0, unit: "IU" },
    "Vitamin E": { adult: 12.7, growth: 9.5, repro: 9.5, unit: "IU" },
    Thiamine: { adult: 1.47, growth: 1.40, repro: 1.40, unit: "mg" },
    Riboflavin: { adult: 1.05, growth: 0.80, repro: 0.80, unit: "mg" },
    Niacin: { adult: 10.5, growth: 8.0, repro: 8.0, unit: "mg" },
    Pantothenic: { adult: 1.92, growth: 1.43, repro: 1.43, unit: "mg" },
    Pyridoxine: { adult: 0.83, growth: 0.63, repro: 0.63, unit: "mg" },
    Biotin: { adult: 20, growth: 17.5, repro: 17.5, unit: "µg" },
    Folate: { adult: 253, growth: 188, repro: 188, unit: "µg" },
    Cobalamin: { adult: 5.87, growth: 4.50, repro: 4.50, unit: "µg" },
    Choline: { adult: 800, growth: 600, repro: 600, unit: "mg" },
  }
};

// Complete INGREDIENT_LIBRARY with ALL 45 ingredients - sorted alphabetically
const INGREDIENT_LIBRARY = [
  {
    id: "apple_red",
    name: "Apple, red",
    asFedPer100g: {
      ME_kcal: 51.86, moisture_pct: 85.33, protein_pct: 0.27, fat_pct: 0.2, ash_pct: 0.14, fiber_pct: 2.3, carb_pct: 14.06,
      Arginine_g: 0.01, Histidine_g: 0.01, Isoleucine_g: 0.01, Leucine_g: 0.01, Lysine_g: 0.01, Methionine_g: 0.0, MethionineCystine_g: 0.0, Phenylalanine_g: 0.01, PhenylalanineTyrosine_g: 0.01, Threonine_g: 0.01, Tryptophan_g: 0.0, Valine_g: 0.01, Taurine_g: 0.0,
      Calcium_pct: 0.01, Phosphorus_pct: 0.01, Sodium_pct: 0.0, Potassium_pct: 0.1, Chloride_pct: 0.0, Magnesium_pct: 0.01,
      Zinc_mg: 0.04, Iron_mg: 0.11, Copper_mg: 0.03, Iodine_mg: 0.0, Manganese_mg: 0.03, Selenium_mg: 0.0,
      VitaminA_IU: 55.0, VitaminD_IU: 0.0, VitaminE_IU: 0.24, Thiamine_mg: 0.02, Riboflavin_mg: 0.03, Niacin_mg: 0.08, Pantothenic_mg: 0.05, Pyridoxine_mg: 0.03, Biotin_ug: 0.0, Folate_ug: 3.0, Cobalamin_ug: 0.0, Choline_mg: 3.4,
      LinoleicAcid_g: 0.0, ArachidonicAcid_g: 0.0, AlphaLinolenicAcid_g: 0.0, EPADHA_g: 0.0,
    },
  },
  {
    id: "apples_with_skin_granny_smith_raw",
    name: "Apples, with skin, granny smith, raw",
    asFedPer100g: {
      ME_kcal: 50.79, moisture_pct: 85.46, protein_pct: 0.44, fat_pct: 0.19, ash_pct: 0.29, fiber_pct: 2.8, carb_pct: 13.61,
      Arginine_g: 0.01, Histidine_g: 0.01, Isoleucine_g: 0.01, Leucine_g: 0.01, Lysine_g: 0.01, Methionine_g: 0.0, MethionineCystine_g: 0.0, Phenylalanine_g: 0.01, PhenylalanineTyrosine_g: 0.01, Threonine_g: 0.01, Tryptophan_g: 0.0, Valine_g: 0.01, Taurine_g: 0.0,
      Calcium_pct: 0.01, Phosphorus_pct: 0.01, Sodium_pct: 0.0, Potassium_pct: 0.12, Chloride_pct: 0.0, Magnesium_pct: 0.01,
      Zinc_mg: 0.04, Iron_mg: 0.15, Copper_mg: 0.03, Iodine_mg: 0.0, Manganese_mg: 0.04, Selenium_mg: 0.1,
      VitaminA_IU: 100.0, VitaminD_IU: 0.0, VitaminE_IU: 0.18, Thiamine_mg: 0.02, Riboflavin_mg: 0.03, Niacin_mg: 0.13, Pantothenic_mg: 0.06, Pyridoxine_mg: 0.04, Biotin_ug: 0.0, Folate_ug: 3.0, Cobalamin_ug: 0.0, Choline_mg: 3.4,
      LinoleicAcid_g: 0.0, ArachidonicAcid_g: 0.0, AlphaLinolenicAcid_g: 0.0, EPADHA_g: 0.0,
    },
  },
  {
    id: "beef_raw_75%_lean_meat_/_25%_fat_ground",
    name: "Beef, raw, 75% lean meat / 25% fat, ground",
    asFedPer100g: {
      ME_kcal: 267.66, moisture_pct: 58.09, protein_pct: 15.76, fat_pct: 25.0, ash_pct: 0.77, fiber_pct: 0.0, carb_pct: 0.0,
      Arginine_g: 1.03, Histidine_g: 0.51, Isoleucine_g: 0.7, Leucine_g: 1.23, Lysine_g: 1.3, Methionine_g: 0.41, MethionineCystine_g: 0.57, Phenylalanine_g: 0.62, PhenylalanineTyrosine_g: 1.3, Threonine_g: 0.61, Tryptophan_g: 0.08, Valine_g: 0.77, Taurine_g: 0.0,
      Calcium_pct: 0.02, Phosphorus_pct: 0.15, Sodium_pct: 0.07, Potassium_pct: 0.24, Chloride_pct: 0.1, Magnesium_pct: 0.02,
      Zinc_mg: 3.87, Iron_mg: 1.79, Copper_mg: 0.06, Iodine_mg: 0.01, Manganese_mg: 0.01, Selenium_mg: 14.3,
      VitaminA_IU: 14.0, VitaminD_IU: 3.0, VitaminE_IU: 0.17, Thiamine_mg: 0.04, Riboflavin_mg: 0.15, Niacin_mg: 3.8, Pantothenic_mg: 0.45, Pyridoxine_mg: 0.3, Biotin_ug: 0.0, Folate_ug: 0.0, Cobalamin_ug: 2.11, Choline_mg: 51.6,
      LinoleicAcid_g: 0.5, ArachidonicAcid_g: 0.035, AlphaLinolenicAcid_g: 0.07, EPADHA_g: 0.0,
    },
  },
  {
    id: "beef_raw_95%_lean_meat_/_5%_fat_ground",
    name: "Beef, raw, 95% lean meat / 5% fat, ground",
    asFedPer100g: {
      ME_kcal: 117.44, moisture_pct: 73.28, protein_pct: 21.41, fat_pct: 5.0, ash_pct: 1.05, fiber_pct: 0.0, carb_pct: 0.0,
      Arginine_g: 1.4, Histidine_g: 0.7, Isoleucine_g: 0.95, Leucine_g: 1.67, Lysine_g: 1.78, Methionine_g: 0.55, MethionineCystine_g: 0.77, Phenylalanine_g: 0.84, PhenylalanineTyrosine_g: 1.5, Threonine_g: 0.83, Tryptophan_g: 0.11, Valine_g: 1.05, Taurine_g: 0.0,
      Calcium_pct: 0.01, Phosphorus_pct: 0.2, Sodium_pct: 0.07, Potassium_pct: 0.35, Chloride_pct: 0.1, Magnesium_pct: 0.02,
      Zinc_mg: 5.09, Iron_mg: 2.38, Copper_mg: 0.08, Iodine_mg: 0.02, Manganese_mg: 0.01, Selenium_mg: 17.4,
      VitaminA_IU: 14.0, VitaminD_IU: 3.0, VitaminE_IU: 0.17, Thiamine_mg: 0.04, Riboflavin_mg: 0.16, Niacin_mg: 5.49, Pantothenic_mg: 0.64, Pyridoxine_mg: 0.39, Biotin_ug: 0.0, Folate_ug: 5.0, Cobalamin_ug: 2.24, Choline_mg: 70.9,
      LinoleicAcid_g: 0.18, ArachidonicAcid_g: 0.035, AlphaLinolenicAcid_g: 0.03, EPADHA_g: 0.0,
    },
  },
  {
    id: "beef_raw_choice_trimmed_to_1_8__fat_separable_lean_and_fat_steak_topsirloin",
    name: "Beef, raw, choice, trimmed to 1/8\" fat, separable lean and fat, steak, topsirloin",
    asFedPer100g: {
      ME_kcal: 201.06, moisture_pct: 64.87, protein_pct: 19.92, fat_pct: 14.28, ash_pct: 0.97, fiber_pct: 0.0, carb_pct: 0.0,
      Arginine_g: 1.25, Histidine_g: 0.62, Isoleucine_g: 0.88, Leucine_g: 1.54, Lysine_g: 1.64, Methionine_g: 0.5, MethionineCystine_g: 0.75, Phenylalanine_g: 0.77, PhenylalanineTyrosine_g: 1.38, Threonine_g: 0.77, Tryptophan_g: 0.13, Valine_g: 0.96, Taurine_g: 0.0,
      Calcium_pct: 0.03, Phosphorus_pct: 0.18, Sodium_pct: 0.05, Potassium_pct: 0.31, Chloride_pct: 0.08, Magnesium_pct: 0.02,
      Zinc_mg: 3.57, Iron_mg: 1.46, Copper_mg: 0.07, Iodine_mg: 0.0, Manganese_mg: 0.01, Selenium_mg: 21.8,
      VitaminA_IU: 0.0, VitaminD_IU: 0.0, VitaminE_IU: 0.37, Thiamine_mg: 0.05, Riboflavin_mg: 0.08, Niacin_mg: 6.43, Pantothenic_mg: 0.58, Pyridoxine_mg: 0.54, Biotin_ug: 0.0, Folate_ug: 11.0, Cobalamin_ug: 1.11, Choline_mg: 83.2,
      LinoleicAcid_g: 0.35, ArachidonicAcid_g: 0.023, AlphaLinolenicAcid_g: 0.17, EPADHA_g: 0.0,
    },
  },
  {
    id: "beef_raw_liver_variety_meats_and_by_products",
    name: "Beef, raw, liver, variety meats and by-products",
    asFedPer100g: {
      ME_kcal: 115.73, moisture_pct: 70.81, protein_pct: 20.36, fat_pct: 3.63, ash_pct: 1.31, fiber_pct: 0.0, carb_pct: 3.89,
      Arginine_g: 1.24, Histidine_g: 0.63, Isoleucine_g: 0.97, Leucine_g: 1.91, Lysine_g: 1.61, Methionine_g: 0.54, MethionineCystine_g: 0.92, Phenylalanine_g: 1.08, PhenylalanineTyrosine_g: 1.87, Threonine_g: 0.87, Tryptophan_g: 0.26, Valine_g: 1.26, Taurine_g: 0.0,
      Calcium_pct: 0.01, Phosphorus_pct: 0.39, Sodium_pct: 0.07, Potassium_pct: 0.31, Chloride_pct: 0.11, Magnesium_pct: 0.02,
      Zinc_mg: 4.0, Iron_mg: 4.9, Copper_mg: 9.76, Iodine_mg: 0.04, Manganese_mg: 0.31, Selenium_mg: 39.7,
      VitaminA_IU: 16898.0, VitaminD_IU: 49.0, VitaminE_IU: 0.38, Thiamine_mg: 0.19, Riboflavin_mg: 2.76, Niacin_mg: 13.18, Pantothenic_mg: 7.17, Pyridoxine_mg: 1.08, Biotin_ug: 0.0, Folate_ug: 290.0, Cobalamin_ug: 59.3, Choline_mg: 333.3,
      LinoleicAcid_g: 0.3, ArachidonicAcid_g: 0.141, AlphaLinolenicAcid_g: 0.01, EPADHA_g: 0.0,
    },
  },
  {
    id: "cabbage_raw_red",
    name: "Cabbage, raw, red",
    asFedPer100g: {
      ME_kcal: 32.16, moisture_pct: 90.39, protein_pct: 1.43, fat_pct: 0.16, ash_pct: 0.64, fiber_pct: 2.1, carb_pct: 7.37,
      Arginine_g: 0.08, Histidine_g: 0.02, Isoleucine_g: 0.03, Leucine_g: 0.05, Lysine_g: 0.05, Methionine_g: 0.01, MethionineCystine_g: 0.03, Phenylalanine_g: 0.04, PhenylalanineTyrosine_g: 0.06, Threonine_g: 0.04, Tryptophan_g: 0.01, Valine_g: 0.0, Taurine_g: 0.0,
      Calcium_pct: 0.05, Phosphorus_pct: 0.03, Sodium_pct: 0.03, Potassium_pct: 0.24, Chloride_pct: 0.04, Magnesium_pct: 0.02,
      Zinc_mg: 0.22, Iron_mg: 0.8, Copper_mg: 0.02, Iodine_mg: 0.0, Manganese_mg: 0.24, Selenium_mg: 0.6,
      VitaminA_IU: 1116.0, VitaminD_IU: 0.0, VitaminE_IU: 0.11, Thiamine_mg: 0.06, Riboflavin_mg: 0.07, Niacin_mg: 0.42, Pantothenic_mg: 0.15, Pyridoxine_mg: 0.21, Biotin_ug: 0.0, Folate_ug: 18.0, Cobalamin_ug: 0.0, Choline_mg: 17.1,
      LinoleicAcid_g: 0.03, ArachidonicAcid_g: 0.0, AlphaLinolenicAcid_g: 0.05, EPADHA_g: 0.0,
    },
  },
  {
    id: "calcium_carbonate",
    name: "Calcium Carbonate",
    asFedPer100g: {
      ME_kcal: 0.0, moisture_pct: 0.0, protein_pct: 0.0, fat_pct: 0.0, ash_pct: 97.5, fiber_pct: 0.0, carb_pct: 0.0,
      Arginine_g: 0.0, Histidine_g: 0.0, Isoleucine_g: 0.0, Leucine_g: 0.0, Lysine_g: 0.0, Methionine_g: 0.0, MethionineCystine_g: 0.0, Phenylalanine_g: 0.0, PhenylalanineTyrosine_g: 0.0, Threonine_g: 0.0, Tryptophan_g: 0.0, Valine_g: 0.0, Taurine_g: 0.0,
      Calcium_pct: 38.13, Phosphorus_pct: 0.04, Sodium_pct: 0.07, Potassium_pct: 0.04, Chloride_pct: 0.11, Magnesium_pct: 0.41,
      Zinc_mg: 0.0, Iron_mg: 0.06, Copper_mg: 0.0, Iodine_mg: 0.0, Manganese_mg: 0.02, Selenium_mg: 0.01,
      VitaminA_IU: 0.0, VitaminD_IU: 0.0, VitaminE_IU: 0.0, Thiamine_mg: 0.0, Riboflavin_mg: 0.0, Niacin_mg: 0.0, Pantothenic_mg: 0.0, Pyridoxine_mg: 0.0, Biotin_ug: 0.0, Folate_ug: 0.0, Cobalamin_ug: 0.0, Choline_mg: 0.0,
      LinoleicAcid_g: 0.0, ArachidonicAcid_g: 0.0, AlphaLinolenicAcid_g: 0.0, EPADHA_g: 0.0,
    },
  },
  {
    id: "carrots_raw",
    name: "Carrots, raw",
    asFedPer100g: {
      ME_kcal: 38.82, moisture_pct: 88.29, protein_pct: 0.93, fat_pct: 0.24, ash_pct: 0.97, fiber_pct: 2.8, carb_pct: 9.58,
      Arginine_g: 0.09, Histidine_g: 0.04, Isoleucine_g: 0.08, Leucine_g: 0.1, Lysine_g: 0.1, Methionine_g: 0.02, MethionineCystine_g: 0.1, Phenylalanine_g: 0.06, PhenylalanineTyrosine_g: 0.1, Threonine_g: 0.19, Tryptophan_g: 0.01, Valine_g: 0.07, Taurine_g: 0.0,
      Calcium_pct: 0.03, Phosphorus_pct: 0.04, Sodium_pct: 0.07, Potassium_pct: 0.32, Chloride_pct: 0.11, Magnesium_pct: 0.01,
      Zinc_mg: 0.24, Iron_mg: 0.3, Copper_mg: 0.05, Iodine_mg: 0.0, Manganese_mg: 0.14, Selenium_mg: 0.1,
      VitaminA_IU: 16706.0, VitaminD_IU: 0.0, VitaminE_IU: 0.66, Thiamine_mg: 0.07, Riboflavin_mg: 0.06, Niacin_mg: 0.98, Pantothenic_mg: 0.27, Pyridoxine_mg: 0.14, Biotin_ug: 0.0, Folate_ug: 19.0, Cobalamin_ug: 0.0, Choline_mg: 8.8,
      LinoleicAcid_g: 0.0, ArachidonicAcid_g: 0.0, AlphaLinolenicAcid_g: 0.0, EPADHA_g: 0.0,
    },
  },
  {
    id: "chicken_back_carcass",
    name: "Chicken back, carcass",
    asFedPer100g: {
      ME_kcal: 63.0, moisture_pct: 62.3, protein_pct: 18.0, fat_pct: 0.0, ash_pct: 6.3, fiber_pct: 0.0, carb_pct: 0.0,
      Arginine_g: 0.0, Histidine_g: 0.0, Isoleucine_g: 0.0, Leucine_g: 0.0, Lysine_g: 0.0, Methionine_g: 0.0, MethionineCystine_g: 0.0, Phenylalanine_g: 0.0, PhenylalanineTyrosine_g: 0.0, Threonine_g: 0.0, Tryptophan_g: 0.0, Valine_g: 0.0, Taurine_g: 0.0,
      Calcium_pct: 1.63, Phosphorus_pct: 0.87, Sodium_pct: 0.6, Potassium_pct: 0.19, Chloride_pct: 0.92, Magnesium_pct: 0.04,
      Zinc_mg: 2.3, Iron_mg: 2.0, Copper_mg: 0.0, Iodine_mg: 0.0, Manganese_mg: 0.0, Selenium_mg: 0.0,
      VitaminA_IU: 0.0, VitaminD_IU: 0.0, VitaminE_IU: 0.0, Thiamine_mg: 0.0, Riboflavin_mg: 0.0, Niacin_mg: 0.0, Pantothenic_mg: 0.0, Pyridoxine_mg: 0.0, Biotin_ug: 0.0, Folate_ug: 0.0, Cobalamin_ug: 0.0, Choline_mg: 0.0,
      LinoleicAcid_g: 0.0, ArachidonicAcid_g: 0.0, AlphaLinolenicAcid_g: 0.0, EPADHA_g: 0.0,
    },
  },
  {
    id: "chicken_raw_all_classes_heart",
    name: "Chicken, raw, all classes, heart",
    asFedPer100g: {
      ME_kcal: 144.35, moisture_pct: 73.56, protein_pct: 15.55, fat_pct: 9.33, ash_pct: 0.85, fiber_pct: 0.0, carb_pct: 0.71,
      Arginine_g: 1.0, Histidine_g: 0.41, Isoleucine_g: 0.83, Leucine_g: 1.36, Lysine_g: 1.3, Methionine_g: 0.38, MethionineCystine_g: 0.59, Phenylalanine_g: 0.7, PhenylalanineTyrosine_g: 1.25, Threonine_g: 0.7, Tryptophan_g: 0.2, Valine_g: 0.88, Taurine_g: 0.0,
      Calcium_pct: 0.01, Phosphorus_pct: 0.18, Sodium_pct: 0.07, Potassium_pct: 0.18, Chloride_pct: 0.11, Magnesium_pct: 0.02,
      Zinc_mg: 6.59, Iron_mg: 5.96, Copper_mg: 0.35, Iodine_mg: 0.01, Manganese_mg: 0.09, Selenium_mg: 4.3,
      VitaminA_IU: 30.0, VitaminD_IU: 0.0, VitaminE_IU: 0.0, Thiamine_mg: 0.15, Riboflavin_mg: 0.73, Niacin_mg: 4.88, Pantothenic_mg: 2.56, Pyridoxine_mg: 0.36, Biotin_ug: 0.0, Folate_ug: 72.0, Cobalamin_ug: 7.29, Choline_mg: 0.0,
      LinoleicAcid_g: 1.91, ArachidonicAcid_g: 0.72, AlphaLinolenicAcid_g: 0.07, EPADHA_g: 0.0,
    },
  },
  {
    id: "chicken_raw_all_classes_liver",
    name: "Chicken, raw, all classes, liver",
    asFedPer100g: {
      ME_kcal: 111.66, moisture_pct: 76.46, protein_pct: 16.92, fat_pct: 4.83, ash_pct: 1.06, fiber_pct: 0.0, carb_pct: 0.73,
      Arginine_g: 1.09, Histidine_g: 0.51, Isoleucine_g: 0.81, Leucine_g: 1.51, Lysine_g: 1.33, Methionine_g: 0.43, MethionineCystine_g: 0.7, Phenylalanine_g: 0.82, PhenylalanineTyrosine_g: 1.48, Threonine_g: 0.72, Tryptophan_g: 0.18, Valine_g: 1.0, Taurine_g: 0.0,
      Calcium_pct: 0.01, Phosphorus_pct: 0.3, Sodium_pct: 0.07, Potassium_pct: 0.23, Chloride_pct: 0.11, Magnesium_pct: 0.02,
      Zinc_mg: 2.67, Iron_mg: 8.99, Copper_mg: 0.49, Iodine_mg: 0.01, Manganese_mg: 0.26, Selenium_mg: 54.6,
      VitaminA_IU: 11078.0, VitaminD_IU: 0.0, VitaminE_IU: 7.0, Thiamine_mg: 0.3, Riboflavin_mg: 1.78, Niacin_mg: 9.73, Pantothenic_mg: 6.23, Pyridoxine_mg: 0.85, Biotin_ug: 0.0, Folate_ug: 588.0, Cobalamin_ug: 16.58, Choline_mg: 194.4,
      LinoleicAcid_g: 0.48, ArachidonicAcid_g: 0.33, AlphaLinolenicAcid_g: 0.01, EPADHA_g: 0.0,
    },
  },
  {
    id: "chicken_raw_meat_only_boneless_skinless_breast",
    name: "Chicken, raw, meat only, boneless, skinless, breast",
    asFedPer100g: {
      ME_kcal: 102.6, moisture_pct: 73.9, protein_pct: 23.0, fat_pct: 2.6, ash_pct: 1.13, fiber_pct: 0.0, carb_pct: 0.0,
      Arginine_g: 1.52, Histidine_g: 0.84, Isoleucine_g: 1.1, Leucine_g: 1.86, Lysine_g: 2.16, Methionine_g: 0.58, MethionineCystine_g: 0.82, Phenylalanine_g: 0.91, PhenylalanineTyrosine_g: 1.72, Threonine_g: 1.01, Tryptophan_g: 0.28, Valine_g: 1.16, Taurine_g: 0.02,
      Calcium_pct: 0.01, Phosphorus_pct: 0.17, Sodium_pct: 0.06, Potassium_pct: 0.22, Chloride_pct: 0.1, Magnesium_pct: 0.03,
      Zinc_mg: 0.8, Iron_mg: 0.74, Copper_mg: 0.04, Iodine_mg: 0.0, Manganese_mg: 0.02, Selenium_mg: 16.6,
      VitaminA_IU: 30.0, VitaminD_IU: 4.0, VitaminE_IU: 2.7, Thiamine_mg: 0.16, Riboflavin_mg: 0.01, Niacin_mg: 1.47, Pantothenic_mg: 0.0, Pyridoxine_mg: 0.09, Biotin_ug: 0.0, Folate_ug: 96.0, Cobalamin_ug: 0.0, Choline_mg: 2.1,
      LinoleicAcid_g: 0.32, ArachidonicAcid_g: 0.02, AlphaLinolenicAcid_g: 0.02, EPADHA_g: 0.01,
    },
  },
  {
    id: "chicken_thigh_ground",
    name: "Chicken thigh, ground",
    asFedPer100g: {
      ME_kcal: 155.16, moisture_pct: 70.63, protein_pct: 17.49, fat_pct: 9.83, ash_pct: 1.64, fiber_pct: 0.0, carb_pct: 0.41,
      Arginine_g: 1.12, Histidine_g: 0.62, Isoleucine_g: 0.73, Leucine_g: 1.33, Lysine_g: 1.44, Methionine_g: 0.3, MethionineCystine_g: 0.59, Phenylalanine_g: 0.69, PhenylalanineTyrosine_g: 1.26, Threonine_g: 0.75, Tryptophan_g: 0.15, Valine_g: 1.09, Taurine_g: 0.0,
      Calcium_pct: 0.52, Phosphorus_pct: 0.49, Sodium_pct: 0.08, Potassium_pct: 0.25, Chloride_pct: 0.12, Magnesium_pct: 0.03,
      Zinc_mg: 1.41, Iron_mg: 1.35, Copper_mg: 0.35, Iodine_mg: 0.0, Manganese_mg: 0.0, Selenium_mg: 0.0,
      VitaminA_IU: 81.5, VitaminD_IU: 0.0, VitaminE_IU: 0.02, Thiamine_mg: 0.07, Riboflavin_mg: 0.09, Niacin_mg: 0.0, Pantothenic_mg: 0.83, Pyridoxine_mg: 0.0, Biotin_ug: 468.6, Folate_ug: 3.6, Cobalamin_ug: 3.1, Choline_mg: 70.9,
      LinoleicAcid_g: 2.03, ArachidonicAcid_g: 0.03, AlphaLinolenicAcid_g: 0.1, EPADHA_g: 0.0,
    },
  },
  {
    id: "corn_raw_yellow_sweet",
    name: "Corn raw, yellow, sweet",
    asFedPer100g: {
      ME_kcal: 88.37, moisture_pct: 66.05, protein_pct: 3.27, fat_pct: 1.35, ash_pct: 0.62, fiber_pct: 2.0, carb_pct: 18.7,
      Arginine_g: 0.13, Histidine_g: 0.09, Isoleucine_g: 0.13, Leucine_g: 0.35, Lysine_g: 0.14, Methionine_g: 0.07, MethionineCystine_g: 0.1, Phenylalanine_g: 0.15, PhenylalanineTyrosine_g: 0.27, Threonine_g: 0.13, Tryptophan_g: 0.02, Valine_g: 0.18, Taurine_g: 0.0,
      Calcium_pct: 0.0, Phosphorus_pct: 0.09, Sodium_pct: 0.02, Potassium_pct: 0.27, Chloride_pct: 0.02, Magnesium_pct: 0.04,
      Zinc_mg: 0.46, Iron_mg: 0.52, Copper_mg: 0.05, Iodine_mg: 0.0, Manganese_mg: 0.16, Selenium_mg: 0.6,
      VitaminA_IU: 187.0, VitaminD_IU: 0.0, VitaminE_IU: 0.07, Thiamine_mg: 0.16, Riboflavin_mg: 0.06, Niacin_mg: 1.77, Pantothenic_mg: 0.72, Pyridoxine_mg: 0.09, Biotin_ug: 0.0, Folate_ug: 42.0, Cobalamin_ug: 0.0, Choline_mg: 23.0,
      LinoleicAcid_g: 0.47, ArachidonicAcid_g: 0.0, AlphaLinolenicAcid_g: 0.01, EPADHA_g: 0.0,
    },
  },
  {
    id: "cowpeas_raw_young_pods_with_seeds",
    name: "Cowpeas, raw, young pods with seeds",
    asFedPer100g: {
      ME_kcal: 47.35, moisture_pct: 86.0, protein_pct: 3.3, fat_pct: 0.3, ash_pct: 0.9, fiber_pct: 3.3, carb_pct: 9.5,
      Arginine_g: 0.0, Histidine_g: 0.0, Isoleucine_g: 0.0, Leucine_g: 0.0, Lysine_g: 0.0, Methionine_g: 0.0, MethionineCystine_g: 0.0, Phenylalanine_g: 0.0, PhenylalanineTyrosine_g: 0.0, Threonine_g: 0.0, Tryptophan_g: 0.0, Valine_g: 0.0, Taurine_g: 0.0,
      Calcium_pct: 0.07, Phosphorus_pct: 0.07, Sodium_pct: 0.0, Potassium_pct: 0.22, Chloride_pct: 0.01, Magnesium_pct: 0.06,
      Zinc_mg: 0.34, Iron_mg: 1.0, Copper_mg: 0.1, Iodine_mg: 0.0, Manganese_mg: 0.31, Selenium_mg: 0.9,
      VitaminA_IU: 800.0, VitaminD_IU: 0.0, VitaminE_IU: 0.49, Thiamine_mg: 0.15, Riboflavin_mg: 0.14, Niacin_mg: 1.2, Pantothenic_mg: 0.94, Pyridoxine_mg: 0.17, Biotin_ug: 0.0, Folate_ug: 53.0, Cobalamin_ug: 0.0, Choline_mg: 22.0,
      LinoleicAcid_g: 0.07, ArachidonicAcid_g: 0.0, AlphaLinolenicAcid_g: 0.05, EPADHA_g: 0.0,
    },
  },
  {
    id: "duck_raw_liver_domesticated",
    name: "Duck, raw, liver, domesticated",
    asFedPer100g: {
      ME_kcal: 117.39, moisture_pct: 71.78, protein_pct: 18.74, fat_pct: 4.64, ash_pct: 1.32, fiber_pct: 0.0, carb_pct: 3.53,
      Arginine_g: 1.15, Histidine_g: 0.5, Isoleucine_g: 1.0, Leucine_g: 1.69, Lysine_g: 1.42, Methionine_g: 0.44, MethionineCystine_g: 0.7, Phenylalanine_g: 0.93, PhenylalanineTyrosine_g: 1.59, Threonine_g: 0.83, Tryptophan_g: 0.26, Valine_g: 1.18, Taurine_g: 0.0,
      Calcium_pct: 0.01, Phosphorus_pct: 0.27, Sodium_pct: 0.14, Potassium_pct: 0.23, Chloride_pct: 0.22, Magnesium_pct: 0.02,
      Zinc_mg: 3.07, Iron_mg: 30.53, Copper_mg: 5.96, Iodine_mg: 0.01, Manganese_mg: 0.26, Selenium_mg: 67.0,
      VitaminA_IU: 39907.0, VitaminD_IU: 0.0, VitaminE_IU: 0.0, Thiamine_mg: 0.56, Riboflavin_mg: 0.89, Niacin_mg: 6.5, Pantothenic_mg: 6.18, Pyridoxine_mg: 0.76, Biotin_ug: 0.0, Folate_ug: 738.0, Cobalamin_ug: 54.0, Choline_mg: 194.4,
      LinoleicAcid_g: 0.37, ArachidonicAcid_g: 0.26, AlphaLinolenicAcid_g: 0.0, EPADHA_g: 0.0,
    },
  },
  {
    id: "duck_raw_meat_only_domesticated",
    name: "Duck, raw, meat only, domesticated",
    asFedPer100g: {
      ME_kcal: 117.85, moisture_pct: 73.77, protein_pct: 18.28, fat_pct: 5.95, ash_pct: 1.06, fiber_pct: 0.0, carb_pct: 0.94,
      Arginine_g: 1.17, Histidine_g: 0.48, Isoleucine_g: 0.94, Leucine_g: 1.54, Lysine_g: 1.56, Methionine_g: 0.49, MethionineCystine_g: 0.78, Phenylalanine_g: 0.77, PhenylalanineTyrosine_g: 1.46, Threonine_g: 0.78, Tryptophan_g: 0.25, Valine_g: 0.96, Taurine_g: 0.0,
      Calcium_pct: 0.01, Phosphorus_pct: 0.2, Sodium_pct: 0.07, Potassium_pct: 0.27, Chloride_pct: 0.11, Magnesium_pct: 0.02,
      Zinc_mg: 1.9, Iron_mg: 2.4, Copper_mg: 0.25, Iodine_mg: 0.0, Manganese_mg: 0.02, Selenium_mg: 13.9,
      VitaminA_IU: 79.0, VitaminD_IU: 3.0, VitaminE_IU: 0.7, Thiamine_mg: 0.36, Riboflavin_mg: 0.45, Niacin_mg: 5.3, Pantothenic_mg: 1.6, Pyridoxine_mg: 0.34, Biotin_ug: 0.0, Folate_ug: 25.0, Cobalamin_ug: 0.4, Choline_mg: 53.6,
      LinoleicAcid_g: 0.67, ArachidonicAcid_g: 0.0, AlphaLinolenicAcid_g: 0.08, EPADHA_g: 0.0,
    },
  },
  {
    id: "egg_fresh_raw_yolk",
    name: "Egg, fresh, raw, yolk",
    asFedPer100g: {
      ME_kcal: 303.39, moisture_pct: 52.31, protein_pct: 15.86, fat_pct: 26.54, ash_pct: 1.71, fiber_pct: 0.0, carb_pct: 3.59,
      Arginine_g: 1.1, Histidine_g: 0.42, Isoleucine_g: 0.87, Leucine_g: 1.4, Lysine_g: 1.22, Methionine_g: 0.38, MethionineCystine_g: 0.54, Phenylalanine_g: 0.68, PhenylalanineTyrosine_g: 1.26, Threonine_g: 0.69, Tryptophan_g: 0.18, Valine_g: 0.95, Taurine_g: 0.0,
      Calcium_pct: 0.13, Phosphorus_pct: 0.39, Sodium_pct: 0.05, Potassium_pct: 0.11, Chloride_pct: 0.07, Magnesium_pct: 0.01,
      Zinc_mg: 2.3, Iron_mg: 2.73, Copper_mg: 0.08, Iodine_mg: 0.0, Manganese_mg: 0.06, Selenium_mg: 56.0,
      VitaminA_IU: 1442.0, VitaminD_IU: 218.0, VitaminE_IU: 2.58, Thiamine_mg: 0.18, Riboflavin_mg: 0.53, Niacin_mg: 0.02, Pantothenic_mg: 2.99, Pyridoxine_mg: 0.35, Biotin_ug: 0.0, Folate_ug: 146.0, Cobalamin_ug: 1.95, Choline_mg: 820.0,
      LinoleicAcid_g: 3.54, ArachidonicAcid_g: 0.438, AlphaLinolenicAcid_g: 0.1, EPADHA_g: 0.12,
    },
  },
  {
    id: "egg_raw_fresh_without_shell_whole_chicken",
    name: "Egg, raw, fresh, without shell, whole Chicken",
    asFedPer100g: {
      ME_kcal: 166.96, moisture_pct: 70.83, protein_pct: 12.81, fat_pct: 13.77, ash_pct: 1.14, fiber_pct: 0.0, carb_pct: 1.45,
      Arginine_g: 0.77, Histidine_g: 0.32, Isoleucine_g: 0.6, Leucine_g: 1.1, Lysine_g: 0.95, Methionine_g: 0.58, MethionineCystine_g: 0.86, Phenylalanine_g: 0.84, PhenylalanineTyrosine_g: 1.05, Threonine_g: 0.74, Tryptophan_g: 0.26, Valine_g: 0.88, Taurine_g: 0.0,
      Calcium_pct: 0.06, Phosphorus_pct: 0.22, Sodium_pct: 0.15, Potassium_pct: 0.22, Chloride_pct: 0.22, Magnesium_pct: 0.02,
      Zinc_mg: 1.41, Iron_mg: 3.85, Copper_mg: 0.06, Iodine_mg: 0.0, Manganese_mg: 0.04, Selenium_mg: 36.4,
      VitaminA_IU: 674.0, VitaminD_IU: 69.0, VitaminE_IU: 1.34, Thiamine_mg: 0.16, Riboflavin_mg: 0.4, Niacin_mg: 0.2, Pantothenic_mg: 1.86, Pyridoxine_mg: 0.25, Biotin_ug: 0.0, Folate_ug: 80.0, Cobalamin_ug: 5.4, Choline_mg: 263.4,
      LinoleicAcid_g: 0.56, ArachidonicAcid_g: 0.0032, AlphaLinolenicAcid_g: 0.1, EPADHA_g: 0.0,
    },
  },
  {
    id: "egg_shell",
    name: "Egg shell",
    asFedPer100g: {
      ME_kcal: 0.0, moisture_pct: 0.0, protein_pct: 0.0, fat_pct: 0.0, ash_pct: 97.5, fiber_pct: 0.0, carb_pct: 0.0,
      Arginine_g: 0.0, Histidine_g: 0.0, Isoleucine_g: 0.0, Leucine_g: 0.0, Lysine_g: 0.0, Methionine_g: 0.0, MethionineCystine_g: 0.0, Phenylalanine_g: 0.0, PhenylalanineTyrosine_g: 0.0, Threonine_g: 0.0, Tryptophan_g: 0.0, Valine_g: 0.0, Taurine_g: 0.0,
      Calcium_pct: 37.0, Phosphorus_pct: 0.04, Sodium_pct: 0.07, Potassium_pct: 0.04, Chloride_pct: 0.11, Magnesium_pct: 0.41,
      Zinc_mg: 0.0, Iron_mg: 0.06, Copper_mg: 0.0, Iodine_mg: 0.0, Manganese_mg: 0.02, Selenium_mg: 0.01,
      VitaminA_IU: 0.0, VitaminD_IU: 0.0, VitaminE_IU: 0.0, Thiamine_mg: 0.0, Riboflavin_mg: 0.0, Niacin_mg: 0.0, Pantothenic_mg: 0.0, Pyridoxine_mg: 0.0, Biotin_ug: 0.0, Folate_ug: 0.0, Cobalamin_ug: 0.0, Choline_mg: 0.0,
      LinoleicAcid_g: 0.0, ArachidonicAcid_g: 0.0, AlphaLinolenicAcid_g: 0.0, EPADHA_g: 0.0,
    },
  },
  {
    id: "fat_chicken",
    name: "Fat, chicken",
    asFedPer100g: {
      ME_kcal: 848.3, moisture_pct: 0.2, protein_pct: 0.0, fat_pct: 99.8, ash_pct: 0.0, fiber_pct: 0.0, carb_pct: 0.0,
      Arginine_g: 0.0, Histidine_g: 0.0, Isoleucine_g: 0.0, Leucine_g: 0.0, Lysine_g: 0.0, Methionine_g: 0.0, MethionineCystine_g: 0.0, Phenylalanine_g: 0.0, PhenylalanineTyrosine_g: 0.0, Threonine_g: 0.0, Tryptophan_g: 0.0, Valine_g: 0.0, Taurine_g: 0.0,
      Calcium_pct: 0.0, Phosphorus_pct: 0.0, Sodium_pct: 0.0, Potassium_pct: 0.0, Chloride_pct: 0.0, Magnesium_pct: 0.0,
      Zinc_mg: 0.0, Iron_mg: 0.0, Copper_mg: 0.0, Iodine_mg: 0.0, Manganese_mg: 0.0, Selenium_mg: 0.0,
      VitaminA_IU: 0.0, VitaminD_IU: 191.0, VitaminE_IU: 2.7, Thiamine_mg: 0.0, Riboflavin_mg: 0.0, Niacin_mg: 0.0, Pantothenic_mg: 0.0, Pyridoxine_mg: 0.0, Biotin_ug: 0.0, Folate_ug: 0.0, Cobalamin_ug: 0.0, Choline_mg: 0.0,
      LinoleicAcid_g: 19.5, ArachidonicAcid_g: 0.1, AlphaLinolenicAcid_g: 1.0, EPADHA_g: 0.0,
    },
  },
  {
    id: "fish_oil_salmon",
    name: "Fish oil, salmon",
    asFedPer100g: {
      ME_kcal: 850.0, moisture_pct: 0.0, protein_pct: 0.0, fat_pct: 100.0, ash_pct: 0.0, fiber_pct: 0.0, carb_pct: 0.0,
      Arginine_g: 0.0, Histidine_g: 0.0, Isoleucine_g: 0.0, Leucine_g: 0.0, Lysine_g: 0.0, Methionine_g: 0.0, MethionineCystine_g: 0.0, Phenylalanine_g: 0.0, PhenylalanineTyrosine_g: 0.0, Threonine_g: 0.0, Tryptophan_g: 0.0, Valine_g: 0.0, Taurine_g: 0.0,
      Calcium_pct: 0.0, Phosphorus_pct: 0.0, Sodium_pct: 0.0, Potassium_pct: 0.0, Chloride_pct: 0.0, Magnesium_pct: 0.0,
      Zinc_mg: 0.0, Iron_mg: 0.0, Copper_mg: 0.0, Iodine_mg: 0.0, Manganese_mg: 0.0, Selenium_mg: 0.0,
      VitaminA_IU: 0.0, VitaminD_IU: 0.0, VitaminE_IU: 0.0, Thiamine_mg: 0.0, Riboflavin_mg: 0.0, Niacin_mg: 0.0, Pantothenic_mg: 0.0, Pyridoxine_mg: 0.0, Biotin_ug: 0.0, Folate_ug: 0.0, Cobalamin_ug: 0.0, Choline_mg: 0.0,
      LinoleicAcid_g: 1.54, ArachidonicAcid_g: 0.675, AlphaLinolenicAcid_g: 1.06, EPADHA_g: 31.26,
    },
  },
  {
    id: "fish_raw_farmed_atlantic_salmon",
    name: "Fish, raw, farmed, Atlantic, salmon",
    asFedPer100g: {
      ME_kcal: 185.54, moisture_pct: 64.89, protein_pct: 20.42, fat_pct: 13.42, ash_pct: 0.06, fiber_pct: 0.0, carb_pct: 0.0,
      Arginine_g: 1.22, Histidine_g: 0.55, Isoleucine_g: 0.97, Leucine_g: 1.65, Lysine_g: 1.87, Methionine_g: 0.84, MethionineCystine_g: 1.6, Phenylalanine_g: 0.86, PhenylalanineTyrosine_g: 1.6, Threonine_g: 0.86, Tryptophan_g: 0.21, Valine_g: 1.11, Taurine_g: 0.0,
      Calcium_pct: 0.01, Phosphorus_pct: 0.24, Sodium_pct: 0.06, Potassium_pct: 0.36, Chloride_pct: 0.09, Magnesium_pct: 0.03,
      Zinc_mg: 0.36, Iron_mg: 0.54, Copper_mg: 0.05, Iodine_mg: 0.0, Manganese_mg: 0.01, Selenium_mg: 24.0,
      VitaminA_IU: 193.0, VitaminD_IU: 44.1, VitaminE_IU: 3.55, Thiamine_mg: 0.21, Riboflavin_mg: 0.16, Niacin_mg: 8.67, Pantothenic_mg: 1.55, Pyridoxine_mg: 0.64, Biotin_ug: 0.0, Folate_ug: 3.23, Cobalamin_ug: 3.23, Choline_mg: 78.5,
      LinoleicAcid_g: 0.9, ArachidonicAcid_g: 0.092, AlphaLinolenicAcid_g: 0.15, EPADHA_g: 1.96,
    },
  },
  {
    id: "fish_raw_farmed_channel_catfish",
    name: "Fish, raw, farmed, channel, catfish",
    asFedPer100g: {
      ME_kcal: 103.8, moisture_pct: 79.06, protein_pct: 15.23, fat_pct: 5.94, ash_pct: 1.05, fiber_pct: 0.0, carb_pct: 0.0,
      Arginine_g: 0.95, Histidine_g: 0.33, Isoleucine_g: 0.68, Leucine_g: 1.15, Lysine_g: 1.39, Methionine_g: 0.44, MethionineCystine_g: 0.61, Phenylalanine_g: 0.61, PhenylalanineTyrosine_g: 1.11, Threonine_g: 0.69, Tryptophan_g: 0.18, Valine_g: 0.74, Taurine_g: 0.0,
      Calcium_pct: 0.01, Phosphorus_pct: 0.2, Sodium_pct: 0.1, Potassium_pct: 0.3, Chloride_pct: 0.15, Magnesium_pct: 0.02,
      Zinc_mg: 0.48, Iron_mg: 0.23, Copper_mg: 0.03, Iodine_mg: 0.01, Manganese_mg: 0.02, Selenium_mg: 8.2,
      VitaminA_IU: 1.0, VitaminD_IU: 9.0, VitaminE_IU: 0.81, Thiamine_mg: 0.02, Riboflavin_mg: 0.08, Niacin_mg: 2.11, Pantothenic_mg: 0.67, Pyridoxine_mg: 0.15, Biotin_ug: 0.0, Folate_ug: 10.0, Cobalamin_ug: 2.88, Choline_mg: 65.0,
      LinoleicAcid_g: 0.8, ArachidonicAcid_g: 0.044, AlphaLinolenicAcid_g: 0.07, EPADHA_g: 0.07,
    },
  },
  {
    id: "fish_raw_king_mackerel",
    name: "Fish, raw, king, Mackerel",
    asFedPer100g: {
      ME_kcal: 87.98, moisture_pct: 75.85, protein_pct: 20.28, fat_pct: 2.0, ash_pct: 1.28, fiber_pct: 0.0, carb_pct: 0.0,
      Arginine_g: 1.21, Histidine_g: 0.6, Isoleucine_g: 0.94, Leucine_g: 1.65, Lysine_g: 1.86, Methionine_g: 0.6, MethionineCystine_g: 0.82, Phenylalanine_g: 0.79, PhenylalanineTyrosine_g: 1.48, Threonine_g: 0.89, Tryptophan_g: 0.23, Valine_g: 1.04, Taurine_g: 0.0,
      Calcium_pct: 0.03, Phosphorus_pct: 0.25, Sodium_pct: 0.16, Potassium_pct: 0.44, Chloride_pct: 0.24, Magnesium_pct: 0.03,
      Zinc_mg: 0.56, Iron_mg: 1.78, Copper_mg: 0.03, Iodine_mg: 0.02, Manganese_mg: 0.01, Selenium_mg: 36.5,
      VitaminA_IU: 727.0, VitaminD_IU: 0.0, VitaminE_IU: 0.0, Thiamine_mg: 0.1, Riboflavin_mg: 0.48, Niacin_mg: 8.59, Pantothenic_mg: 0.84, Pyridoxine_mg: 0.44, Biotin_ug: 0.0, Folate_ug: 8.0, Cobalamin_ug: 15.6, Choline_mg: 0.0,
      LinoleicAcid_g: 0.04, ArachidonicAcid_g: 0.0, AlphaLinolenicAcid_g: 0.09, EPADHA_g: 0.0,
    },
  },
  {
    id: "fish_raw_mixed_species_sea_bass",
    name: "Fish, raw, mixed species, sea bass",
    asFedPer100g: {
      ME_kcal: 81.5, moisture_pct: 78.27, protein_pct: 18.43, fat_pct: 2.0, ash_pct: 1.09, fiber_pct: 0.0, carb_pct: 0.0,
      Arginine_g: 1.1, Histidine_g: 0.54, Isoleucine_g: 0.85, Leucine_g: 1.5, Lysine_g: 1.69, Methionine_g: 0.55, MethionineCystine_g: 0.74, Phenylalanine_g: 0.72, PhenylalanineTyrosine_g: 1.34, Threonine_g: 0.81, Tryptophan_g: 0.21, Valine_g: 0.95, Taurine_g: 0.0,
      Calcium_pct: 0.01, Phosphorus_pct: 0.19, Sodium_pct: 0.07, Potassium_pct: 0.26, Chloride_pct: 0.1, Magnesium_pct: 0.04,
      Zinc_mg: 0.4, Iron_mg: 0.29, Copper_mg: 0.02, Iodine_mg: 0.02, Manganese_mg: 0.02, Selenium_mg: 36.5,
      VitaminA_IU: 154.0, VitaminD_IU: 226.0, VitaminE_IU: 0.84, Thiamine_mg: 0.11, Riboflavin_mg: 0.12, Niacin_mg: 1.6, Pantothenic_mg: 0.75, Pyridoxine_mg: 0.4, Biotin_ug: 0.0, Folate_ug: 5.0, Cobalamin_ug: 0.3, Choline_mg: 60.8,
      LinoleicAcid_g: 0.02, ArachidonicAcid_g: 0.0, AlphaLinolenicAcid_g: 0.0, EPADHA_g: 0.6,
    },
  },
  {
    id: "fish_raw_yellowfin_fresh_tuna",
    name: "Fish, raw, yellowfin, fresh, tuna",
    asFedPer100g: {
      ME_kcal: 89.57, moisture_pct: 74.03, protein_pct: 24.4, fat_pct: 0.49, ash_pct: 1.64, fiber_pct: 0.0, carb_pct: 0.0,
      Arginine_g: 1.4, Histidine_g: 0.69, Isoleucine_g: 1.08, Leucine_g: 1.9, Lysine_g: 2.15, Methionine_g: 0.69, MethionineCystine_g: 0.94, Phenylalanine_g: 0.91, PhenylalanineTyrosine_g: 1.7, Threonine_g: 1.02, Tryptophan_g: 0.26, Valine_g: 1.2, Taurine_g: 0.0,
      Calcium_pct: 0.0, Phosphorus_pct: 0.28, Sodium_pct: 0.05, Potassium_pct: 0.44, Chloride_pct: 0.07, Magnesium_pct: 0.04,
      Zinc_mg: 0.37, Iron_mg: 0.77, Copper_mg: 0.04, Iodine_mg: 0.02, Manganese_mg: 0.01, Selenium_mg: 90.6,
      VitaminA_IU: 60.0, VitaminD_IU: 69.0, VitaminE_IU: 0.24, Thiamine_mg: 0.12, Riboflavin_mg: 0.12, Niacin_mg: 18.48, Pantothenic_mg: 0.28, Pyridoxine_mg: 0.93, Biotin_ug: 0.0, Folate_ug: 2.0, Cobalamin_ug: 2.08, Choline_mg: 65.0,
      LinoleicAcid_g: 0.18, ArachidonicAcid_g: 0.015, AlphaLinolenicAcid_g: 0.0, EPADHA_g: 0.0,
    },
  },
  {
    id: "lentils_without_salt_boiled_cooked_mature_seeds",
    name: "Lentils, without salt, boiled, cooked, mature seeds",
    asFedPer100g: {
      ME_kcal: 105.26, moisture_pct: 69.64, protein_pct: 9.02, fat_pct: 0.38, ash_pct: 0.83, fiber_pct: 7.9, carb_pct: 20.13,
      Arginine_g: 0.7, Histidine_g: 0.25, Isoleucine_g: 0.39, Leucine_g: 0.65, Lysine_g: 0.63, Methionine_g: 0.08, MethionineCystine_g: 0.2, Phenylalanine_g: 0.45, PhenylalanineTyrosine_g: 0.69, Threonine_g: 0.24, Tryptophan_g: 0.08, Valine_g: 0.45, Taurine_g: 0.0,
      Calcium_pct: 0.02, Phosphorus_pct: 0.18, Sodium_pct: 0.0, Potassium_pct: 0.37, Chloride_pct: 0.0, Magnesium_pct: 0.04,
      Zinc_mg: 1.27, Iron_mg: 3.33, Copper_mg: 0.25, Iodine_mg: 0.0, Manganese_mg: 0.49, Selenium_mg: 2.8,
      VitaminA_IU: 8.0, VitaminD_IU: 0.0, VitaminE_IU: 0.11, Thiamine_mg: 0.17, Riboflavin_mg: 0.07, Niacin_mg: 0.0, Pantothenic_mg: 0.64, Pyridoxine_mg: 0.18, Biotin_ug: 0.0, Folate_ug: 181.0, Cobalamin_ug: 0.0, Choline_mg: 32.7,
      LinoleicAcid_g: 0.14, ArachidonicAcid_g: 0.0, AlphaLinolenicAcid_g: 0.04, EPADHA_g: 0.0,
    },
  },
  {
    id: "oil_approx__65_linoleic_sunflower",
    name: "Oil, (approx. 65%), linoleic, sunflower",
    asFedPer100g: {
      ME_kcal: 850.0, moisture_pct: 0.0, protein_pct: 0.0, fat_pct: 100.0, ash_pct: 0.0, fiber_pct: 0.0, carb_pct: 0.0,
      Arginine_g: 0.0, Histidine_g: 0.0, Isoleucine_g: 0.0, Leucine_g: 0.0, Lysine_g: 0.0, Methionine_g: 0.0, MethionineCystine_g: 0.0, Phenylalanine_g: 0.0, PhenylalanineTyrosine_g: 0.0, Threonine_g: 0.0, Tryptophan_g: 0.0, Valine_g: 0.0, Taurine_g: 0.0,
      Calcium_pct: 0.0, Phosphorus_pct: 0.0, Sodium_pct: 0.0, Potassium_pct: 0.0, Chloride_pct: 0.0, Magnesium_pct: 0.0,
      Zinc_mg: 0.0, Iron_mg: 0.0, Copper_mg: 0.0, Iodine_mg: 0.0, Manganese_mg: 0.0, Selenium_mg: 0.0,
      VitaminA_IU: 0.0, VitaminD_IU: 0.0, VitaminE_IU: 41.08, Thiamine_mg: 0.0, Riboflavin_mg: 0.0, Niacin_mg: 0.0, Pantothenic_mg: 0.0, Pyridoxine_mg: 0.0, Biotin_ug: 0.0, Folate_ug: 0.0, Cobalamin_ug: 0.0, Choline_mg: 0.0,
      LinoleicAcid_g: 65.7, ArachidonicAcid_g: 0.0, AlphaLinolenicAcid_g: 0.0, EPADHA_g: 0.0,
    },
  },
  {
    id: "parsley_fresh",
    name: "Parsley, fresh",
    asFedPer100g: {
      ME_kcal: 39.27, moisture_pct: 87.71, protein_pct: 2.97, fat_pct: 0.79, ash_pct: 2.2, fiber_pct: 3.3, carb_pct: 6.33,
      Arginine_g: 0.12, Histidine_g: 0.06, Isoleucine_g: 0.12, Leucine_g: 0.2, Lysine_g: 0.18, Methionine_g: 0.04, MethionineCystine_g: 0.06, Phenylalanine_g: 0.15, PhenylalanineTyrosine_g: 0.23, Threonine_g: 0.12, Tryptophan_g: 0.04, Valine_g: 0.17, Taurine_g: 0.0,
      Calcium_pct: 0.14, Phosphorus_pct: 0.06, Sodium_pct: 0.06, Potassium_pct: 0.55, Chloride_pct: 0.09, Magnesium_pct: 0.05,
      Zinc_mg: 1.07, Iron_mg: 6.2, Copper_mg: 0.15, Iodine_mg: 0.0, Manganese_mg: 0.16, Selenium_mg: 0.1,
      VitaminA_IU: 8424.0, VitaminD_IU: 0.0, VitaminE_IU: 0.75, Thiamine_mg: 0.09, Riboflavin_mg: 0.1, Niacin_mg: 1.31, Pantothenic_mg: 0.4, Pyridoxine_mg: 0.09, Biotin_ug: 0.0, Folate_ug: 152.0, Cobalamin_ug: 0.0, Choline_mg: 12.8,
      LinoleicAcid_g: 0.11, ArachidonicAcid_g: 0.0, AlphaLinolenicAcid_g: 0.01, EPADHA_g: 0.0,
    },
  },
  {
    id: "peas_raw_green",
    name: "Peas, raw, green",
    asFedPer100g: {
      ME_kcal: 72.95, moisture_pct: 78.86, protein_pct: 5.42, fat_pct: 0.4, ash_pct: 0.87, fiber_pct: 5.1, carb_pct: 14.45,
      Arginine_g: 0.43, Histidine_g: 0.11, Isoleucine_g: 0.2, Leucine_g: 0.32, Lysine_g: 0.32, Methionine_g: 0.08, MethionineCystine_g: 0.11, Phenylalanine_g: 0.2, PhenylalanineTyrosine_g: 0.31, Threonine_g: 0.2, Tryptophan_g: 0.04, Valine_g: 0.24, Taurine_g: 0.0,
      Calcium_pct: 0.03, Phosphorus_pct: 0.11, Sodium_pct: 0.01, Potassium_pct: 0.24, Chloride_pct: 0.01, Magnesium_pct: 0.03,
      Zinc_mg: 1.24, Iron_mg: 1.47, Copper_mg: 0.02, Iodine_mg: 0.0, Manganese_mg: 0.41, Selenium_mg: 1.8,
      VitaminA_IU: 380.0, VitaminD_IU: 0.0, VitaminE_IU: 1.3, Thiamine_mg: 0.27, Riboflavin_mg: 0.13, Niacin_mg: 2.09, Pantothenic_mg: 0.1, Pyridoxine_mg: 0.17, Biotin_ug: 0.0, Folate_ug: 65.0, Cobalamin_ug: 0.0, Choline_mg: 28.4,
      LinoleicAcid_g: 0.15, ArachidonicAcid_g: 0.0, AlphaLinolenicAcid_g: 0.04, EPADHA_g: 0.0,
    },
  },
  {
    id: "peppers_raw_red_sweet",
    name: "Peppers, raw, red, sweet",
    asFedPer100g: {
      ME_kcal: 27.12, moisture_pct: 92.21, protein_pct: 0.99, fat_pct: 0.3, ash_pct: 0.47, fiber_pct: 2.1, carb_pct: 6.03,
      Arginine_g: 0.04, Histidine_g: 0.02, Isoleucine_g: 0.02, Leucine_g: 0.04, Lysine_g: 0.04, Methionine_g: 0.01, MethionineCystine_g: 0.03, Phenylalanine_g: 0.05, PhenylalanineTyrosine_g: 0.06, Threonine_g: 0.04, Tryptophan_g: 0.01, Valine_g: 0.03, Taurine_g: 0.0,
      Calcium_pct: 0.01, Phosphorus_pct: 0.03, Sodium_pct: 0.01, Potassium_pct: 0.21, Chloride_pct: 0.02, Magnesium_pct: 0.01,
      Zinc_mg: 0.25, Iron_mg: 0.43, Copper_mg: 0.02, Iodine_mg: 0.0, Manganese_mg: 0.11, Selenium_mg: 0.1,
      VitaminA_IU: 3131.0, VitaminD_IU: 0.0, VitaminE_IU: 1.58, Thiamine_mg: 0.05, Riboflavin_mg: 0.09, Niacin_mg: 0.98, Pantothenic_mg: 0.32, Pyridoxine_mg: 0.29, Biotin_ug: 0.0, Folate_ug: 0.0, Cobalamin_ug: 0.0, Choline_mg: 5.6,
      LinoleicAcid_g: 0.04, ArachidonicAcid_g: 0.0, AlphaLinolenicAcid_g: 0.03, EPADHA_g: 0.0,
    },
  },
  {
    id: "peppers_raw_yellow_sweet",
    name: "Peppers, raw, yellow, sweet",
    asFedPer100g: {
      ME_kcal: 27.4, moisture_pct: 92.02, protein_pct: 0.99, fat_pct: 0.21, ash_pct: 0.45, fiber_pct: 0.9, carb_pct: 6.32,
      Arginine_g: 0.05, Histidine_g: 0.02, Isoleucine_g: 0.03, Leucine_g: 0.05, Lysine_g: 0.04, Methionine_g: 0.01, MethionineCystine_g: 0.03, Phenylalanine_g: 0.03, PhenylalanineTyrosine_g: 0.05, Threonine_g: 0.04, Tryptophan_g: 0.01, Valine_g: 0.04, Taurine_g: 0.0,
      Calcium_pct: 0.01, Phosphorus_pct: 0.02, Sodium_pct: 0.0, Potassium_pct: 0.21, Chloride_pct: 0.0, Magnesium_pct: 0.01,
      Zinc_mg: 0.17, Iron_mg: 0.46, Copper_mg: 0.11, Iodine_mg: 0.0, Manganese_mg: 0.12, Selenium_mg: 0.3,
      VitaminA_IU: 200.0, VitaminD_IU: 0.0, VitaminE_IU: 0.0, Thiamine_mg: 0.03, Riboflavin_mg: 0.03, Niacin_mg: 0.89, Pantothenic_mg: 0.17, Pyridoxine_mg: 0.17, Biotin_ug: 0.0, Folate_ug: 0.0, Cobalamin_ug: 0.0, Choline_mg: 0.0,
      LinoleicAcid_g: 0.0, ArachidonicAcid_g: 0.0, AlphaLinolenicAcid_g: 0.0, EPADHA_g: 0.0,
    },
  },
  {
    id: "psyllium_husk_powder",
    name: "Psyllium husk powder",
    asFedPer100g: {
      ME_kcal: 333.34, moisture_pct: 8.86, protein_pct: 4.28, fat_pct: 1.96, ash_pct: 2.13, fiber_pct: 3.6, carb_pct: 79.17,
      Arginine_g: 0.0, Histidine_g: 0.0, Isoleucine_g: 0.0, Leucine_g: 0.0, Lysine_g: 0.0, Methionine_g: 0.0, MethionineCystine_g: 0.0, Phenylalanine_g: 0.0, PhenylalanineTyrosine_g: 0.0, Threonine_g: 0.0, Tryptophan_g: 0.0, Valine_g: 0.0, Taurine_g: 0.0,
      Calcium_pct: 0.33, Phosphorus_pct: 0.0, Sodium_pct: 0.0, Potassium_pct: 0.0, Chloride_pct: 0.0, Magnesium_pct: 0.0,
      Zinc_mg: 0.0, Iron_mg: 0.0, Copper_mg: 0.0, Iodine_mg: 2.0, Manganese_mg: 0.0, Selenium_mg: 0.0,
      VitaminA_IU: 0.0, VitaminD_IU: 0.0, VitaminE_IU: 0.0, Thiamine_mg: 0.0, Riboflavin_mg: 0.0, Niacin_mg: 0.0, Pantothenic_mg: 0.0, Pyridoxine_mg: 0.0, Biotin_ug: 0.0, Folate_ug: 0.0, Cobalamin_ug: 0.0, Choline_mg: 0.0,
      LinoleicAcid_g: 0.0, ArachidonicAcid_g: 0.0, AlphaLinolenicAcid_g: 0.0, EPADHA_g: 0.0,
    },
  },
  {
    id: "pumpkin_raw",
    name: "Pumpkin, raw",
    asFedPer100g: {
      ME_kcal: 27.1, moisture_pct: 91.6, protein_pct: 1.0, fat_pct: 0.1, ash_pct: 0.8, fiber_pct: 0.5, carb_pct: 6.5,
      Arginine_g: 0.05, Histidine_g: 0.02, Isoleucine_g: 0.03, Leucine_g: 0.05, Lysine_g: 0.05, Methionine_g: 0.01, MethionineCystine_g: 0.01, Phenylalanine_g: 0.03, PhenylalanineTyrosine_g: 0.07, Threonine_g: 0.03, Tryptophan_g: 0.01, Valine_g: 0.04, Taurine_g: 0.0,
      Calcium_pct: 0.02, Phosphorus_pct: 0.04, Sodium_pct: 0.01, Potassium_pct: 0.34, Chloride_pct: 0.02, Magnesium_pct: 0.01,
      Zinc_mg: 0.32, Iron_mg: 0.8, Copper_mg: 0.13, Iodine_mg: 0.0, Manganese_mg: 0.12, Selenium_mg: 0.3,
      VitaminA_IU: 8513.0, VitaminD_IU: 0.0, VitaminE_IU: 1.06, Thiamine_mg: 0.05, Riboflavin_mg: 0.11, Niacin_mg: 0.6, Pantothenic_mg: 0.3, Pyridoxine_mg: 0.06, Biotin_ug: 0.0, Folate_ug: 0.0, Cobalamin_ug: 0.0, Choline_mg: 8.2,
      LinoleicAcid_g: 0.0, ArachidonicAcid_g: 0.0, AlphaLinolenicAcid_g: 0.0, EPADHA_g: 0.0,
    },
  },
  {
    id: "rice_cooked_long_grain_brown",
    name: "Rice, cooked, long-grain, brown",
    asFedPer100g: {
      ME_kcal: 107.36, moisture_pct: 70.27, protein_pct: 2.74, fat_pct: 0.97, ash_pct: 0.44, fiber_pct: 1.6, carb_pct: 25.58,
      Arginine_g: 0.2, Histidine_g: 0.07, Isoleucine_g: 0.11, Leucine_g: 0.21, Lysine_g: 0.1, Methionine_g: 0.06, MethionineCystine_g: 0.09, Phenylalanine_g: 0.13, PhenylalanineTyrosine_g: 0.23, Threonine_g: 0.1, Tryptophan_g: 0.03, Valine_g: 0.15, Taurine_g: 0.0,
      Calcium_pct: 0.0, Phosphorus_pct: 0.1, Sodium_pct: 0.01, Potassium_pct: 0.09, Chloride_pct: 0.02, Magnesium_pct: 0.04,
      Zinc_mg: 0.71, Iron_mg: 0.56, Copper_mg: 0.1, Iodine_mg: 0.0, Manganese_mg: 0.97, Selenium_mg: 5.8,
      VitaminA_IU: 0.0, VitaminD_IU: 0.0, VitaminE_IU: 0.17, Thiamine_mg: 0.18, Riboflavin_mg: 0.07, Niacin_mg: 2.56, Pantothenic_mg: 0.38, Pyridoxine_mg: 0.12, Biotin_ug: 0.0, Folate_ug: 0.0, Cobalamin_ug: 0.0, Choline_mg: 9.2,
      LinoleicAcid_g: 0.36, ArachidonicAcid_g: 0.0, AlphaLinolenicAcid_g: 0.01, EPADHA_g: 0.0,
    },
  },
  {
    id: "rice_cooked_white",
    name: "Rice, cooked, white",
    asFedPer100g: {
      ME_kcal: 109.69, moisture_pct: 68.01, protein_pct: 2.67, fat_pct: 0.28, ash_pct: 0.0, fiber_pct: 0.4, carb_pct: 27.99,
      Arginine_g: 0.0, Histidine_g: 0.0, Isoleucine_g: 0.0, Leucine_g: 0.0, Lysine_g: 0.0, Methionine_g: 0.0, MethionineCystine_g: 0.0, Phenylalanine_g: 0.0, PhenylalanineTyrosine_g: 0.0, Threonine_g: 0.0, Tryptophan_g: 0.0, Valine_g: 0.0, Taurine_g: 0.0,
      Calcium_pct: 0.01, Phosphorus_pct: 0.04, Sodium_pct: 0.25, Potassium_pct: 0.04, Chloride_pct: 0.38, Magnesium_pct: 0.01,
      Zinc_mg: 0.49, Iron_mg: 1.19, Copper_mg: 0.07, Iodine_mg: 0.0, Manganese_mg: 0.0, Selenium_mg: 7.5,
      VitaminA_IU: 0.0, VitaminD_IU: 0.0, VitaminE_IU: 0.06, Thiamine_mg: 0.0, Riboflavin_mg: 0.0, Niacin_mg: 0.0, Pantothenic_mg: 0.0, Pyridoxine_mg: 0.0, Biotin_ug: 0.0, Folate_ug: 0.0, Cobalamin_ug: 0.0, Choline_mg: 0.0,
      LinoleicAcid_g: 0.06, ArachidonicAcid_g: 0.0, AlphaLinolenicAcid_g: 0.01, EPADHA_g: 0.0,
    },
  },
  {
    id: "rice_cooked_without_salt_unenriched_regular_long_grain_white",
    name: "Rice, cooked without salt, unenriched, regular, long-grain, white",
    asFedPer100g: {
      ME_kcal: 110.39, moisture_pct: 68.44, protein_pct: 2.69, fat_pct: 0.28, ash_pct: 0.41, fiber_pct: 0.4, carb_pct: 28.17,
      Arginine_g: 0.22, Histidine_g: 0.06, Isoleucine_g: 0.12, Leucine_g: 0.22, Lysine_g: 0.1, Methionine_g: 0.06, MethionineCystine_g: 0.12, Phenylalanine_g: 0.14, PhenylalanineTyrosine_g: 0.23, Threonine_g: 0.1, Tryptophan_g: 0.03, Valine_g: 0.16, Taurine_g: 0.0,
      Calcium_pct: 0.01, Phosphorus_pct: 0.04, Sodium_pct: 0.01, Potassium_pct: 0.04, Chloride_pct: 0.02, Magnesium_pct: 0.01,
      Zinc_mg: 0.49, Iron_mg: 0.2, Copper_mg: 0.07, Iodine_mg: 0.0, Manganese_mg: 0.47, Selenium_mg: 7.5,
      VitaminA_IU: 0.0, VitaminD_IU: 0.0, VitaminE_IU: 0.04, Thiamine_mg: 0.02, Riboflavin_mg: 0.01, Niacin_mg: 0.4, Pantothenic_mg: 0.39, Pyridoxine_mg: 0.09, Biotin_ug: 0.0, Folate_ug: 3.0, Cobalamin_ug: 0.0, Choline_mg: 2.1,
      LinoleicAcid_g: 0.06, ArachidonicAcid_g: 0.0, AlphaLinolenicAcid_g: 0.01, EPADHA_g: 0.0,
    },
  },
  {
    id: "salmon_oil",
    name: "Salmon oil",
    asFedPer100g: {
      ME_kcal: 850.0, moisture_pct: 0.0, protein_pct: 0.0, fat_pct: 100.0, ash_pct: 0.0, fiber_pct: 0.0, carb_pct: 0.0,
      Arginine_g: 0.0, Histidine_g: 0.0, Isoleucine_g: 0.0, Leucine_g: 0.0, Lysine_g: 0.0, Methionine_g: 0.0, MethionineCystine_g: 0.0, Phenylalanine_g: 0.0, PhenylalanineTyrosine_g: 0.0, Threonine_g: 0.0, Tryptophan_g: 0.0, Valine_g: 0.0, Taurine_g: 0.0,
      Calcium_pct: 0.0, Phosphorus_pct: 0.0, Sodium_pct: 0.0, Potassium_pct: 0.0, Chloride_pct: 0.0, Magnesium_pct: 0.0,
      Zinc_mg: 0.0, Iron_mg: 0.0, Copper_mg: 0.0, Iodine_mg: 0.0, Manganese_mg: 0.0, Selenium_mg: 0.0,
      VitaminA_IU: 0.0, VitaminD_IU: 0.0, VitaminE_IU: 0.0, Thiamine_mg: 0.0, Riboflavin_mg: 0.0, Niacin_mg: 0.0, Pantothenic_mg: 0.0, Pyridoxine_mg: 0.0, Biotin_ug: 0.0, Folate_ug: 0.0, Cobalamin_ug: 0.0, Choline_mg: 0.0,
      LinoleicAcid_g: 1.54, ArachidonicAcid_g: 0.675, AlphaLinolenicAcid_g: 1.06, EPADHA_g: 31.26,
    },
  },
  {
    id: "sweet_potato_unprepared_raw",
    name: "Sweet potato, unprepared, raw",
    asFedPer100g: {
      ME_kcal: 76.34, moisture_pct: 77.28, protein_pct: 1.57, fat_pct: 0.05, ash_pct: 0.99, fiber_pct: 3.0, carb_pct: 20.12,
      Arginine_g: 0.06, Histidine_g: 0.03, Isoleucine_g: 0.06, Leucine_g: 0.09, Lysine_g: 0.07, Methionine_g: 0.03, MethionineCystine_g: 0.04, Phenylalanine_g: 0.09, PhenylalanineTyrosine_g: 0.11, Threonine_g: 0.07, Tryptophan_g: 0.03, Valine_g: 0.08, Taurine_g: 0.0,
      Calcium_pct: 0.03, Phosphorus_pct: 0.05, Sodium_pct: 0.06, Potassium_pct: 0.34, Chloride_pct: 0.08, Magnesium_pct: 0.03,
      Zinc_mg: 0.3, Iron_mg: 0.61, Copper_mg: 0.15, Iodine_mg: 0.0, Manganese_mg: 0.26, Selenium_mg: 0.6,
      VitaminA_IU: 14187.0, VitaminD_IU: 0.0, VitaminE_IU: 0.26, Thiamine_mg: 0.08, Riboflavin_mg: 0.06, Niacin_mg: 0.56, Pantothenic_mg: 0.8, Pyridoxine_mg: 0.21, Biotin_ug: 0.0, Folate_ug: 0.0, Cobalamin_ug: 0.0, Choline_mg: 12.3,
      LinoleicAcid_g: 0.01, ArachidonicAcid_g: 0.0, AlphaLinolenicAcid_g: 0.0, EPADHA_g: 0.0,
    },
  },
  {
    id: "taurine",
    name: "Taurine",
    asFedPer100g: {
      ME_kcal: 0.0, moisture_pct: 0.0, protein_pct: 0.0, fat_pct: 0.0, ash_pct: 0.0, fiber_pct: 0.0, carb_pct: 0.0,
      Arginine_g: 0.0, Histidine_g: 0.0, Isoleucine_g: 0.0, Leucine_g: 0.0, Lysine_g: 0.0, Methionine_g: 0.0, MethionineCystine_g: 0.0, Phenylalanine_g: 0.0, PhenylalanineTyrosine_g: 0.0, Threonine_g: 0.0, Tryptophan_g: 0.0, Valine_g: 0.0, Taurine_g: 98.5,
      Calcium_pct: 0.0, Phosphorus_pct: 0.0, Sodium_pct: 0.0, Potassium_pct: 0.0, Chloride_pct: 0.0, Magnesium_pct: 0.0,
      Zinc_mg: 0.0, Iron_mg: 0.0, Copper_mg: 0.0, Iodine_mg: 0.0, Manganese_mg: 0.0, Selenium_mg: 0.0,
      VitaminA_IU: 0.0, VitaminD_IU: 0.0, VitaminE_IU: 0.0, Thiamine_mg: 0.0, Riboflavin_mg: 0.0, Niacin_mg: 0.0, Pantothenic_mg: 0.0, Pyridoxine_mg: 0.0, Biotin_ug: 0.0, Folate_ug: 0.0, Cobalamin_ug: 0.0, Choline_mg: 0.0,
      LinoleicAcid_g: 0.0, ArachidonicAcid_g: 0.0, AlphaLinolenicAcid_g: 0.0, EPADHA_g: 0.0,
    },
  },
  {
    id: "vitamin_and_mineral_premix",
    name: "Vitamin and Mineral Premix",
    asFedPer100g: {
      ME_kcal: 0.0, moisture_pct: 0.0, protein_pct: 0.0, fat_pct: 0.0, ash_pct: 11.0, fiber_pct: 0.0, carb_pct: 0.0,
      Arginine_g: 0.0, Histidine_g: 0.0, Isoleucine_g: 0.0, Leucine_g: 0.0, Lysine_g: 0.0, Methionine_g: 0.0, MethionineCystine_g: 0.0, Phenylalanine_g: 0.0, PhenylalanineTyrosine_g: 0.0, Threonine_g: 0.0, Tryptophan_g: 0.0, Valine_g: 0.0, Taurine_g: 0.0,
      Calcium_pct: 22.6, Phosphorus_pct: 0.0, Sodium_pct: 0.0, Potassium_pct: 0.0, Chloride_pct: 0.0, Magnesium_pct: 0.0,
      Zinc_mg: 3000.0, Iron_mg: 400.0, Copper_mg: 100.0, Iodine_mg: 70.0, Manganese_mg: 800.0, Selenium_mg: 1000.0,
      VitaminA_IU: 100000.0, VitaminD_IU: 20000.0, VitaminE_IU: 5000.0, Thiamine_mg: 200.0, Riboflavin_mg: 62.0, Niacin_mg: 168.0, Pantothenic_mg: 146.0, Pyridoxine_mg: 50.0, Biotin_ug: 1000.0, Folate_ug: 800.0, Cobalamin_ug: 500.0, Choline_mg: 5000.0,
      LinoleicAcid_g: 0.0, ArachidonicAcid_g: 0.0, AlphaLinolenicAcid_g: 0.0, EPADHA_g: 0.0,
    },
  },
];

// Utility functions
function format(num, digits = 2) {
  if (num === null || num === undefined || isNaN(num)) return "-";
  return new Intl.NumberFormat().format(Number(num.toFixed(digits)));
}

function estimateMEkcalPer100gAF(ingredients) {
  const totalG = ingredients.reduce((s, it) => s + (it.amount_g || 0), 0);
  if (!totalG) return 0;
  const totalME = ingredients.reduce((s, it) => s + ((it.amount_g || 0) / 100) * (it.asFedPer100g?.ME_kcal || 0), 0);
  return (totalME / totalG) * 100;
}

function computeTotals(ingredients) {
  const totalG = ingredients.reduce((s, it) => s + (it.amount_g || 0), 0);
  const blended = {
    mass_g: totalG,
    moisture_pct: 0, protein_pct: 0, fat_pct: 0, ash_pct: 0, fiber_pct: 0, carb_pct: 0,
    Amino: {}, Minerals: {}, Vitamins: {}, FattyAcids: {},
  };
  if (!totalG) return blended;

  const keys = ["moisture_pct", "protein_pct", "fat_pct", "ash_pct", "fiber_pct", "carb_pct"];
  for (const k of keys) {
    blended[k] = ingredients.reduce((s, it) => s + ((it.amount_g || 0) / totalG) * (it.asFedPer100g?.[k] ?? 0), 0);
  }

  const aakeys = ["Arginine_g", "Histidine_g", "Isoleucine_g", "Leucine_g", "Lysine_g", "Methionine_g", "MethionineCystine_g", "Phenylalanine_g", "PhenylalanineTyrosine_g", "Threonine_g", "Tryptophan_g", "Valine_g", "Taurine_g"];
  blended.Amino = Object.fromEntries(aakeys.map(k => [k, ingredients.reduce((s, it) => s + ((it.amount_g || 0) / totalG) * (it.asFedPer100g?.[k] ?? 0), 0)]));

  const mkeys = ["Calcium_pct", "Phosphorus_pct", "Sodium_pct", "Potassium_pct", "Chloride_pct", "Magnesium_pct", "Zinc_mg", "Iron_mg", "Copper_mg", "Iodine_mg", "Manganese_mg", "Selenium_mg"];
  blended.Minerals = Object.fromEntries(mkeys.map(k => [k, ingredients.reduce((s, it) => s + ((it.amount_g || 0) / totalG) * (it.asFedPer100g?.[k] ?? 0), 0)]));

  const vkeys = ["VitaminA_IU", "VitaminD_IU", "VitaminE_IU", "Thiamine_mg", "Riboflavin_mg", "Niacin_mg", "Pantothenic_mg", "Pyridoxine_mg", "Biotin_ug", "Folate_ug", "Cobalamin_ug", "Choline_mg"];
  blended.Vitamins = Object.fromEntries(vkeys.map(k => [k, ingredients.reduce((s, it) => s + ((it.amount_g || 0) / totalG) * (it.asFedPer100g?.[k] ?? 0), 0)]));

  const fakeys = ["LinoleicAcid_g", "ArachidonicAcid_g", "AlphaLinolenicAcid_g", "EPADHA_g"];
  blended.FattyAcids = Object.fromEntries(fakeys.map(k => [k, ingredients.reduce((s, it) => s + ((it.amount_g || 0) / totalG) * (it.asFedPer100g?.[k] ?? 0), 0)]));

  return blended;
}

function calcMERkcalPerDayCat({ bodyWeightKg, basis, factor = 1 }) {
  const bw067 = Math.pow(bodyWeightKg, 0.67);
  const base = basis === 100 ? 100 : 75;
  return base * bw067 * factor;
}

// Ingredient Editor Modal
function IngredientEditorModal({ ingredient, isOpen, onClose, onSave }) {
  const [editedIngredient, setEditedIngredient] = useState(ingredient);

  React.useEffect(() => {
    setEditedIngredient(ingredient);
  }, [ingredient]);

  if (!isOpen) return null;

  const handleNutrientChange = (nutrientKey, value) => {
    setEditedIngredient(prev => ({
      ...prev,
      asFedPer100g: {
        ...prev.asFedPer100g,
        [nutrientKey]: parseFloat(value) || 0
      }
    }));
  };

  const handleNameChange = (name) => {
    setEditedIngredient(prev => ({ ...prev, name }));
  };

  const nutrientGroups = {
    "พลังงานและส่วนประกอบหลัก": [
      { key: "ME_kcal", label: "พลังงาน (kcal/100g)", unit: "kcal" },
      { key: "moisture_pct", label: "ความชื้น", unit: "%" },
      { key: "protein_pct", label: "โปรตีน", unit: "%" },
      { key: "fat_pct", label: "ไขมัน", unit: "%" },
      { key: "ash_pct", label: "เถ้า", unit: "%" },
      { key: "fiber_pct", label: "ใยอาหาร", unit: "%" },
      { key: "carb_pct", label: "คาร์โบไฮเดรต", unit: "%" },
    ],
    "กรดอะมิโน": [
      { key: "Arginine_g", label: "Arginine", unit: "g" },
      { key: "Histidine_g", label: "Histidine", unit: "g" },
      { key: "Isoleucine_g", label: "Isoleucine", unit: "g" },
      { key: "Leucine_g", label: "Leucine", unit: "g" },
      { key: "Lysine_g", label: "Lysine", unit: "g" },
      { key: "Methionine_g", label: "Methionine", unit: "g" },
      { key: "MethionineCystine_g", label: "Methionine + Cystine", unit: "g" },
      { key: "Phenylalanine_g", label: "Phenylalanine", unit: "g" },
      { key: "PhenylalanineTyrosine_g", label: "Phenylalanine + Tyrosine", unit: "g" },
      { key: "Threonine_g", label: "Threonine", unit: "g" },
      { key: "Tryptophan_g", label: "Tryptophan", unit: "g" },
      { key: "Valine_g", label: "Valine", unit: "g" },
      { key: "Taurine_g", label: "Taurine", unit: "g" },
    ],
    "แร่ธาตุ": [
      { key: "Calcium_pct", label: "Calcium", unit: "%" },
      { key: "Phosphorus_pct", label: "Phosphorus", unit: "%" },
      { key: "Sodium_pct", label: "Sodium", unit: "%" },
      { key: "Potassium_pct", label: "Potassium", unit: "%" },
      { key: "Chloride_pct", label: "Chloride", unit: "%" },
      { key: "Magnesium_pct", label: "Magnesium", unit: "%" },
      { key: "Zinc_mg", label: "Zinc", unit: "mg" },
      { key: "Iron_mg", label: "Iron", unit: "mg" },
      { key: "Copper_mg", label: "Copper", unit: "mg" },
      { key: "Iodine_mg", label: "Iodine", unit: "mg" },
      { key: "Manganese_mg", label: "Manganese", unit: "mg" },
      { key: "Selenium_mg", label: "Selenium", unit: "mcg" },
    ],
    "วิตามิน": [
      { key: "VitaminA_IU", label: "Vitamin A", unit: "IU" },
      { key: "VitaminD_IU", label: "Vitamin D", unit: "IU" },
      { key: "VitaminE_IU", label: "Vitamin E", unit: "IU" },
      { key: "Thiamine_mg", label: "Thiamine", unit: "mg" },
      { key: "Riboflavin_mg", label: "Riboflavin", unit: "mg" },
      { key: "Niacin_mg", label: "Niacin", unit: "mg" },
      { key: "Pantothenic_mg", label: "Pantothenic acid", unit: "mg" },
      { key: "Pyridoxine_mg", label: "Pyridoxine (B6)", unit: "mg" },
      { key: "Biotin_ug", label: "Biotin", unit: "µg" },
      { key: "Folate_ug", label: "Folate", unit: "µg" },
      { key: "Cobalamin_ug", label: "Cobalamin (B12)", unit: "µg" },
      { key: "Choline_mg", label: "Choline", unit: "mg" },
    ],
    "กรดไขมัน": [
      { key: "LinoleicAcid_g", label: "Linoleic acid (ω-6)", unit: "g" },
      { key: "ArachidonicAcid_g", label: "Arachidonic acid (ω-6)", unit: "g" },
      { key: "AlphaLinolenicAcid_g", label: "Alpha-linolenic acid (ω-3)", unit: "g" },
      { key: "EPADHA_g", label: "EPA+DHA (ω-3)", unit: "g" },
    ],
  };

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-2xl shadow-xl w-full max-w-4xl h-full max-h-[95vh] flex flex-col">
        <div className="p-6 border-b bg-white rounded-t-2xl flex-shrink-0">
          <div className="flex items-center justify-between">
            <h2 className="text-xl font-semibold">แก้ไขข้อมูลวัตถุดิบ</h2>
            <button onClick={onClose} className="text-gray-500 hover:text-gray-700 p-1">
              <span className="text-2xl">&times;</span>
            </button>
          </div>
        </div>
        
        <div className="flex-1 overflow-y-auto">
          <div className="p-6 space-y-6">
            <div>
              <label className="block text-sm font-medium mb-2">ชื่อวัตถุดิบ</label>
              <input
                type="text"
                value={editedIngredient?.name || ''}
                onChange={(e) => handleNameChange(e.target.value)}
                className="w-full border rounded-lg px-3 py-2"
              />
            </div>

            {Object.entries(nutrientGroups).map(([groupName, nutrients]) => (
              <div key={groupName}>
                <h3 className="text-lg font-medium mb-3 text-sky-700 sticky top-0 bg-white py-2 border-b">{groupName}</h3>
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 pb-4">
                  {nutrients.map(({ key, label, unit }) => (
                    <div key={key}>
                      <label className="block text-sm text-gray-600 mb-1">
                        {label} ({unit})
                      </label>
                      <input
                        type="number"
                        step="any"
                        value={editedIngredient?.asFedPer100g?.[key] || 0}
                        onChange={(e) => handleNutrientChange(key, e.target.value)}
                        className="w-full border rounded-lg px-3 py-2 text-sm"
                      />
                    </div>
                  ))}
                </div>
              </div>
            ))}
          </div>
        </div>

        <div className="p-6 border-t bg-gray-50 rounded-b-2xl flex justify-end gap-3 flex-shrink-0">
          <button onClick={onClose} className="px-4 py-2 border rounded-lg hover:bg-gray-100">ยกเลิก</button>
          <button
            onClick={() => {
              onSave(editedIngredient);
              onClose();
            }}
            className="px-4 py-2 bg-sky-600 text-white rounded-lg hover:bg-sky-700"
          >
            บันทึก
          </button>
        </div>
      </div>
    </div>
  );
}

// Main App Component
export default function App() {
  const [ingredients, setIngredients] = useState([
    { ...INGREDIENT_LIBRARY[1], amount_g: 50 },
    { ...INGREDIENT_LIBRARY[2], amount_g: 30 },
    { ...INGREDIENT_LIBRARY[4], amount_g: 20 }
  ]);
  const [unitSystem, setUnitSystem] = useState("per1000kcal");
  const [life, setLife] = useState("adult");
  const [energyBasis, setEnergyBasis] = useState(75);
  const [energyFactor, setEnergyFactor] = useState(1.0);
  const [catBW, setCatBW] = useState(4.0);
  const [showAddDropdown, setShowAddDropdown] = useState(false);
  const [editingIngredient, setEditingIngredient] = useState(null);
  const [showEditor, setShowEditor] = useState(false);

  const totals = useMemo(() => computeTotals(ingredients), [ingredients]);
  const ME100g = useMemo(() => estimateMEkcalPer100gAF(ingredients), [ingredients]);
  const MER = useMemo(() => calcMERkcalPerDayCat({ bodyWeightKg: catBW, basis: energyBasis, factor: energyFactor }), [catBW, energyBasis, energyFactor]);
  const gramsPerDay = useMemo(() => {
    if (!ME100g) return 0;
    return (MER / ME100g) * 100;
  }, [MER, ME100g]);

  function updateAmount(id, val) {
    setIngredients(prev => prev.map(it => it.id === id ? { ...it, amount_g: Number(val) } : it));
  }

  function addIngredientFromLibrary(libraryItem) {
    const newId = `${libraryItem.id}_${Date.now()}`;
    setIngredients(prev => ([...prev, { ...libraryItem, id: newId, amount_g: 0 }]));
    setShowAddDropdown(false);
  }

  function addCustomIngredient() {
    const id = `custom_${Date.now()}`;
    const newIngredient = {
      id, name: "วัตถุดิบใหม่", amount_g: 0,
      asFedPer100g: {
        ME_kcal: 0, moisture_pct: 70, protein_pct: 0, fat_pct: 0, ash_pct: 0, fiber_pct: 0, carb_pct: 0,
        Arginine_g: 0, Histidine_g: 0, Isoleucine_g: 0, Leucine_g: 0, Lysine_g: 0, Methionine_g: 0, MethionineCystine_g: 0, Phenylalanine_g: 0, PhenylalanineTyrosine_g: 0, Threonine_g: 0, Tryptophan_g: 0, Valine_g: 0, Taurine_g: 0,
        Calcium_pct: 0, Phosphorus_pct: 0, Sodium_pct: 0, Potassium_pct: 0, Chloride_pct: 0, Magnesium_pct: 0,
        Zinc_mg: 0, Iron_mg: 0, Copper_mg: 0, Iodine_mg: 0, Manganese_mg: 0, Selenium_mg: 0,
        VitaminA_IU: 0, VitaminD_IU: 0, VitaminE_IU: 0, Thiamine_mg: 0, Riboflavin_mg: 0, Niacin_mg: 0, Pantothenic_mg: 0, Pyridoxine_mg: 0, Biotin_ug: 0, Folate_ug: 0, Cobalamin_ug: 0, Choline_mg: 0,
        LinoleicAcid_g: 0, ArachidonicAcid_g: 0, AlphaLinolenicAcid_g: 0, EPADHA_g: 0,
      }
    };
    setIngredients(prev => ([...prev, newIngredient]));
    setEditingIngredient(newIngredient);
    setShowEditor(true);
    setShowAddDropdown(false);
  }

  function removeIngredient(id) {
    setIngredients(prev => prev.filter(it => it.id !== id));
  }

  function editIngredient(ingredient) {
    setEditingIngredient(ingredient);
    setShowEditor(true);
  }

  function saveIngredient(editedIngredient) {
    setIngredients(prev => prev.map(it => it.id === editedIngredient.id ? editedIngredient : it));
  }

  // Compute provided nutrients
  const comparison = useMemo(() => {
    const dmPct = 100 - totals.moisture_pct;
    const per100gDM_factor = dmPct > 0 ? (100 / dmPct) : 0;
    const conv_DM_to_1000kcal = 2.5; // FEDIAF conversion factor

    const providedDM = {
      Protein: totals.protein_pct * per100gDM_factor,
      Fat: totals.fat_pct * per100gDM_factor,
      Calcium: totals.Minerals.Calcium_pct * per100gDM_factor,
      Phosphorus: totals.Minerals.Phosphorus_pct * per100gDM_factor,
      Sodium: totals.Minerals.Sodium_pct * per100gDM_factor,
      Potassium: totals.Minerals.Potassium_pct * per100gDM_factor,
      Chloride: totals.Minerals.Chloride_pct * per100gDM_factor,
      Magnesium: totals.Minerals.Magnesium_pct * per100gDM_factor,
      Taurine: totals.Amino.Taurine_g * per100gDM_factor,
      Arginine: totals.Amino.Arginine_g * per100gDM_factor,
      Histidine: totals.Amino.Histidine_g * per100gDM_factor,
      Isoleucine: totals.Amino.Isoleucine_g * per100gDM_factor,
      Leucine: totals.Amino.Leucine_g * per100gDM_factor,
      Lysine: totals.Amino.Lysine_g * per100gDM_factor,
      Methionine: totals.Amino.Methionine_g * per100gDM_factor,
      "Methionine + Cystine": totals.Amino.MethionineCystine_g * per100gDM_factor,
      Phenylalanine: totals.Amino.Phenylalanine_g * per100gDM_factor,
      "Phenylalanine + Tyrosine": totals.Amino.PhenylalanineTyrosine_g * per100gDM_factor,
      Threonine: totals.Amino.Threonine_g * per100gDM_factor,
      Tryptophan: totals.Amino.Tryptophan_g * per100gDM_factor,
      Valine: totals.Amino.Valine_g * per100gDM_factor,
      Zinc: totals.Minerals.Zinc_mg * per100gDM_factor,
      Iron: totals.Minerals.Iron_mg * per100gDM_factor,
      Copper: totals.Minerals.Copper_mg * per100gDM_factor,
      Iodine: totals.Minerals.Iodine_mg * per100gDM_factor,
      Manganese: totals.Minerals.Manganese_mg * per100gDM_factor,
      Selenium: totals.Minerals.Selenium_mg * per100gDM_factor,
      "Vitamin A": totals.Vitamins.VitaminA_IU * per100gDM_factor,
      "Vitamin D": totals.Vitamins.VitaminD_IU * per100gDM_factor,
      "Vitamin E": totals.Vitamins.VitaminE_IU * per100gDM_factor,
      Thiamine: totals.Vitamins.Thiamine_mg * per100gDM_factor,
      Riboflavin: totals.Vitamins.Riboflavin_mg * per100gDM_factor,
      Niacin: totals.Vitamins.Niacin_mg * per100gDM_factor,
      Pantothenic: totals.Vitamins.Pantothenic_mg * per100gDM_factor,
      Pyridoxine: totals.Vitamins.Pyridoxine_mg * per100gDM_factor,
      Biotin: totals.Vitamins.Biotin_ug * per100gDM_factor,
      Folate: totals.Vitamins.Folate_ug * per100gDM_factor,
      Cobalamin: totals.Vitamins.Cobalamin_ug * per100gDM_factor,
      Choline: totals.Vitamins.Choline_mg * per100gDM_factor,
      "Linoleic acid (ω-6)": totals.FattyAcids.LinoleicAcid_g * per100gDM_factor,
      "Arachidonic acid (ω-6)": totals.FattyAcids.ArachidonicAcid_g * per100gDM_factor,
      "Alpha-linolenic acid (ω-3)": totals.FattyAcids.AlphaLinolenicAcid_g * per100gDM_factor,
      "EPA+DHA (ω-3)": totals.FattyAcids.EPADHA_g * per100gDM_factor,
    };

    const provided = {};
    for (const [k, vDM] of Object.entries(providedDM)) {
      if (unitSystem === "per100gDM") {
        provided[k] = vDM;
      } else if (unitSystem === "per1000kcal") {
        provided[k] = vDM * conv_DM_to_1000kcal;
      }
    }

    return { provided };
  }, [totals, unitSystem]);

  const reqTable = FEDIAF_CAT_2024[unitSystem];

  return (
    <div className="min-h-screen w-full bg-slate-50">
      <header className="sticky top-0 z-20 bg-white/70 backdrop-blur border-b">
        <div className="max-w-7xl mx-auto px-4 py-3 flex items-center gap-3">
          <div className="animate-pulse">
            <BarChart3 className="w-6 h-6 text-sky-600" />
          </div>
          <div>
            <h1 className="text-xl font-semibold text-slate-900">Feline Complete & Balance Food Formulator</h1>
            <p className="text-slate-500 text-sm">เครื่องมือสำหรับนักโภชนาการสัตว์ สร้างสูตรอาหารแมวตามมาตรฐาน AAFCO & FEDIAF</p>
          </div>
        </div>
      </header>

      <main className="max-w-7xl mx-auto px-4 py-6 grid lg:grid-cols-3 gap-6">
        {/* Settings Panel */}
        <section className="lg:col-span-1">
          <div className="bg-white rounded-2xl shadow p-4 space-y-4">
            <div className="flex items-center gap-2">
              <Settings2 className="w-5 h-5 text-sky-600" />
              <h2 className="font-semibold">การตั้งค่าการคำนวณ</h2>
            </div>
            
            {/* Cat Basic Info */}
            <div className="bg-blue-50 rounded-xl p-3 space-y-3">
              <h3 className="text-sm font-medium text-blue-800">ข้อมูลพื้นฐานของแมว</h3>
              <div className="grid grid-cols-1 gap-3">
                <label className="text-sm">
                  <span className="font-medium">น้ำหนักตัว</span>
                  <span className="text-blue-600 ml-1">(กิโลกรัม)</span>
                  <input 
                    type="number" 
                    min={0.5} 
                    step={0.1} 
                    value={catBW} 
                    onChange={e => setCatBW(Number(e.target.value))} 
                    className="mt-1 w-full border rounded-xl px-3 py-2" 
                  />
                  <div className="text-xs text-slate-500 mt-1">ป้อนน้ำหนักปัจจุบันของแมวคุณ</div>
                </label>

                <label className="text-sm">
                  <span className="font-medium">ช่วงชีวิตของแมว</span>
                  <select value={life} onChange={e => setLife(e.target.value)} className="mt-1 w-full border rounded-xl px-3 py-2">
                    <option value="adult">แมวโตเต็มวัย (Adult)</option>
                    <option value="growth">ลูกแมวเติบโต (Growth)</option>
                    <option value="repro">แมวตั้งท้อง/ให้นม (Reproduction)</option>
                  </select>
                  <div className="text-xs text-slate-500 mt-1">เลือกช่วงชีวิตที่ตรงกับสภาพแมวคุณ</div>
                </label>
              </div>
            </div>

            {/* Energy Requirements */}
            <div className="bg-emerald-50 rounded-xl p-3 space-y-3">
              <h3 className="text-sm font-medium text-emerald-800">ความต้องการพลังงาน (Energy Requirements)</h3>
              
              <label className="text-sm">
                <span className="font-medium">มาตรฐานอ้างอิง</span>
                <span className="text-emerald-600 ml-1">(Energy Standard)</span>
                <select value={energyBasis} onChange={e => setEnergyBasis(Number(e.target.value))} className="mt-1 w-full border rounded-xl px-3 py-2">
                  <option value={75}>FEDIAF - แมวในบ้าน/ทำหมัน (75 kcal/kg^0.67)</option>
                  <option value={100}>FEDIAF - แมวที่ทำกิจกรรม (100 kcal/kg^0.67)</option>
                </select>
                <div className="text-xs text-slate-500 mt-1 leading-relaxed">
                  <div className="font-medium text-emerald-700 mb-1">คำอธิบาย:</div>
                  <div>• <strong>75 kcal/kg^0.67</strong>: สำหรับแมวที่อยู่ในบ้าน ทำหมันแล้ว หรือมีกิจกรรมน้อย</div>
                  <div>• <strong>100 kcal/kg^0.67</strong>: สำหรับแมวที่ทำกิจกรรมปกติ หรือมีการเคลื่อนไหวมาก</div>
                </div>
              </label>

              <label className="text-sm">
                <span className="font-medium">ตัวคูณปรับสภาวะพิเศษ</span>
                <span className="text-emerald-600 ml-1">(Condition Multiplier)</span>
                <input 
                  type="number" 
                  min={0.5} 
                  step={0.1} 
                  value={energyFactor} 
                  onChange={e => setEnergyFactor(Number(e.target.value))} 
                  className="mt-1 w-full border rounded-xl px-3 py-2" 
                />
                <div className="text-xs text-slate-500 mt-1 leading-relaxed">
                  <div className="font-medium text-emerald-700 mb-1">แนะนำค่าตัวคูณ:</div>
                  <div>• <strong>0.8</strong>: แมวอ้วน/ต้องการลดน้ำหนัก</div>
                  <div>• <strong>1.0</strong>: แมวสุขภาพดี รักษาน้ำหนัก</div>
                  <div>• <strong>1.2-1.4</strong>: แมวตั้งท้อง (ไตรมาสสุดท้าย)</div>
                  <div>• <strong>2.0-4.0</strong>: แมวให้นมลูก (ขึ้นกับจำนวนลูก)</div>
                  <div>• <strong>2.0-3.0</strong>: ลูกแมวเติบโต (4-12 เดือน)</div>
                </div>
              </label>
            </div>

            {/* Standards Reference */}
            <div className="bg-amber-50 rounded-xl p-3 space-y-2">
              <h3 className="text-sm font-medium text-amber-800">มาตรฐานที่ใช้อ้างอิง</h3>
              
              <label className="text-sm">
                <span className="font-medium">หน่วยแสดงผลข้อกำหนด</span>
                <select value={unitSystem} onChange={e => setUnitSystem(e.target.value)} className="mt-1 w-full border rounded-xl px-3 py-2">
                  <option value="per1000kcal">หน่วย/1000 kcal ME</option>
                  <option value="per100gDM">หน่วย/100 g วัตถุแห้ง</option>
                </select>
                <div className="text-xs text-slate-500 mt-1 leading-relaxed">
                  <div>• <strong>หน่วย/1000 kcal</strong>: แสดงสารอาหารต่อพลังงาน (เหมาะสำหรับเปรียบเทียบคุณภาพ)</div>
                  <div>• <strong>หน่วย/100g วัตถุแห้ง</strong>: แสดงสารอาหารต่อน้ำหนักแห้ง (มาตรฐาน FEDIAF)</div>
                </div>
              </label>

              <div className="text-xs text-slate-500 leading-relaxed">
                <div className="font-medium text-amber-700 mb-1">มาตรฐานที่ใช้:</div>
                <div>• <strong>FEDIAF 2024</strong>: สมาคมอุตสาหกรรมอาหารสัตว์เลี้ยงแห่งยุโรป</div>
                <div>• <strong>AAFCO 2024</strong>: สมาคมควบคุมอาหารสัตว์แห่งอเมริกา</div>
                <div className="mt-1 text-amber-600">ระบบจะใช้มาตรฐานที่เข้มงวดกว่าเมื่อมีความแตกต่าง</div>
              </div>
            </div>

            {/* Results */}
            <div className="bg-slate-50 rounded-xl p-3 space-y-3">
              <h3 className="text-sm font-medium text-slate-700">ผลการคำนวณ</h3>
              
              <div className="space-y-2">
                <div className="flex justify-between items-center">
                  <span className="text-sm text-slate-600">พลังงานที่ต้องการต่อวัน</span>
                  <span className="text-lg font-semibold text-slate-800">{format(MER, 0)} kcal</span>
                </div>
                <div className="text-xs text-slate-500 leading-relaxed">
                  <div className="font-medium text-slate-600 mb-1">MER (Maintenance Energy Requirement) คืออะไร?</div>
                  <div>พลังงานที่แมวต้องการในแต่ละวันเพื่อรักษาน้ำหนักตัวและสุขภาพในสภาวะปกติ รวมถึงการเผาผลาญพื้นฐาน การย่อยอาหาร และกิจกรรมทั่วไป</div>
                </div>
                
                <div className="flex justify-between items-center">
                  <span className="text-sm text-slate-600">ปริมาณอาหารโดยประมาณ</span>
                  <span className="text-lg font-semibold text-slate-800">{format(gramsPerDay, 0)} g/วัน</span>
                </div>
                <div className="text-xs text-slate-500">
                  คำนวณจากพลังงานที่ต้องการและความหนาแน่นของพลังงานในสูตรอาหาร
                </div>
              </div>
            </div>
          </div>
        </section>

        {/* Ingredient Management */}
        <section className="lg:col-span-2">
          <div className="bg-white rounded-2xl shadow p-4 mb-6">
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-2">
                <Calculator className="w-5 h-5 text-sky-600" />
                <h2 className="font-semibold">ส่วนผสมสูตร</h2>
              </div>
              <div className="relative">
                <button
                  onClick={() => setShowAddDropdown(!showAddDropdown)}
                  className="inline-flex items-center gap-1 px-3 py-1.5 rounded-xl bg-sky-600 text-white hover:bg-sky-700"
                >
                  <Plus className="w-4 h-4" />เพิ่มวัตถุดิบ<ChevronDown className="w-4 h-4" />
                </button>
                {showAddDropdown && (
                  <div className="absolute right-0 mt-2 w-72 bg-white rounded-xl shadow-lg border z-30">
                    <div className="p-3 border-b">
                      <div className="text-sm font-medium">เลือกวัตถุดิบจากฐานข้อมูล</div>
                    </div>
                    <div className="max-h-60 overflow-y-auto">
                      {INGREDIENT_LIBRARY.map((item) => (
                        <button
                          key={item.id}
                          onClick={() => addIngredientFromLibrary(item)}
                          className="w-full text-left px-3 py-2 hover:bg-slate-50 text-sm border-b last:border-b-0"
                        >
                          <div className="font-medium">{item.name}</div>
                          <div className="text-xs text-slate-500">
                            {format(item.asFedPer100g.ME_kcal)} kcal, โปรตีน {format(item.asFedPer100g.protein_pct)}%
                          </div>
                        </button>
                      ))}
                    </div>
                    <div className="p-3 border-t">
                      <button
                        onClick={addCustomIngredient}
                        className="w-full text-left text-sky-600 hover:text-sky-700 text-sm font-medium"
                      >
                        + สร้างวัตถุดิบใหม่
                      </button>
                    </div>
                  </div>
                )}
              </div>
            </div>

            <div className="mt-4 overflow-x-auto">
              <table className="min-w-full text-sm">
                <thead>
                  <tr className="text-left text-slate-500 border-b">
                    <th className="py-2 pr-3">วัตถุดิบ</th>
                    <th className="py-2 pr-3">ปริมาณ (g)</th>
                    <th className="py-2 pr-3">ME (kcal/100g AF)</th>
                    <th className="py-2 pr-3">โปรตีน (%)</th>
                    <th className="py-2 pr-3">ไขมัน (%)</th>
                    <th className="py-2 pr-3">ความชื้น (%)</th>
                    <th className="py-2">การจัดการ</th>
                  </tr>
                </thead>
                <tbody>
                  {ingredients.map((it) => (
                    <tr key={it.id} className="border-b">
                      <td className="py-2 pr-3">
                        <div className="font-medium text-slate-800">{it.name}</div>
                        <div className="text-xs text-slate-500">
                          Ca {format(it.asFedPer100g.Calcium_pct)}% • P {format(it.asFedPer100g.Phosphorus_pct)}% • Na {format(it.asFedPer100g.Sodium_pct)}%
                        </div>
                      </td>
                      <td className="py-2 pr-3">
                        <input
                          type="number"
                          min={0}
                          step="any"
                          value={it.amount_g}
                          onChange={(e) => updateAmount(it.id, e.target.value)}
                          className="w-28 border rounded-lg px-2 py-1"
                        />
                      </td>
                      <td className="py-2 pr-3">{format(it.asFedPer100g.ME_kcal)}</td>
                      <td className="py-2 pr-3">{format(it.asFedPer100g.protein_pct)}</td>
                      <td className="py-2 pr-3">{format(it.asFedPer100g.fat_pct)}</td>
                      <td className="py-2 pr-3">{format(it.asFedPer100g.moisture_pct)}</td>
                      <td className="py-2">
                        <div className="flex gap-1">
                          <button
                            onClick={() => editIngredient(it)}
                            className="p-2 rounded-lg hover:bg-blue-50 text-blue-500"
                            title="แก้ไข"
                          >
                            <Edit3 className="w-4 h-4" />
                          </button>
                          <button
                            onClick={() => removeIngredient(it.id)}
                            className="p-2 rounded-lg hover:bg-red-50 text-red-500"
                            title="ลบ"
                          >
                            <Trash2 className="w-4 h-4" />
                          </button>
                        </div>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>

            {/* Main Nutrient Composition Table */}
            <div className="mt-6 bg-slate-50 rounded-xl p-4">
              <h3 className="text-lg font-semibold mb-4 text-slate-800">ปริมาณสารอาหารหลักของสูตร</h3>
              <div className="overflow-x-auto">
                <table className="min-w-full text-sm">
                  <thead>
                    <tr className="text-left text-slate-600 border-b border-slate-300">
                      <th className="py-2 pr-4 font-medium">สารอาหาร</th>
                      <th className="py-2 pr-4 font-medium text-right">ปริมาณ</th>
                      <th className="py-2 font-medium">หน่วย</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr className="border-b border-slate-200">
                      <td className="py-2 pr-4 text-slate-700">ความชื้นเฉลี่ย (Moisture)</td>
                      <td className="py-2 pr-4 text-right font-semibold">{format(totals.moisture_pct, 1)}</td>
                      <td className="py-2 text-slate-500">% as Fed</td>
                    </tr>
                    <tr className="border-b border-slate-200">
                      <td className="py-2 pr-4 text-slate-700">วัตถุแห้งเฉลี่ย (Dry Matter)</td>
                      <td className="py-2 pr-4 text-right font-semibold">{format(100 - totals.moisture_pct, 1)}</td>
                      <td className="py-2 text-slate-500">% as Fed</td>
                    </tr>
                    <tr className="border-b border-slate-200">
                      <td className="py-2 pr-4 text-slate-700">พลังงานใช้ประโยชน์ได้เฉลี่ย (ME)</td>
                      <td className="py-2 pr-4 text-right font-semibold">{format(ME100g, 1)}</td>
                      <td className="py-2 text-slate-500">kcal/100g as Fed</td>
                    </tr>
                    <tr className="border-b border-slate-200">
                      <td className="py-2 pr-4 text-slate-700">โปรตีนเฉลี่ย (CP)</td>
                      <td className="py-2 pr-4 text-right font-semibold">{format(totals.protein_pct, 1)}</td>
                      <td className="py-2 text-slate-500">% as Fed</td>
                    </tr>
                    <tr className="border-b border-slate-200">
                      <td className="py-2 pr-4 text-slate-700">คาร์โบไฮเดรทเฉลี่ย (NFE)</td>
                      <td className="py-2 pr-4 text-right font-semibold">{format(totals.carb_pct, 1)}</td>
                      <td className="py-2 text-slate-500">% as Fed</td>
                    </tr>
                    <tr className="border-b border-slate-200">
                      <td className="py-2 pr-4 text-slate-700">ไขมันเฉลี่ย (EE)</td>
                      <td className="py-2 pr-4 text-right font-semibold">{format(totals.fat_pct, 1)}</td>
                      <td className="py-2 text-slate-500">% as Fed</td>
                    </tr>
                    <tr className="border-b border-slate-200">
                      <td className="py-2 pr-4 text-slate-700">กากใยเฉลี่ย (CF)</td>
                      <td className="py-2 pr-4 text-right font-semibold">{format(totals.fiber_pct, 1)}</td>
                      <td className="py-2 text-slate-500">% as Fed</td>
                    </tr>
                    <tr>
                      <td className="py-2 pr-4 text-slate-700">แร่ธาตุเฉลี่ย (Ash)</td>
                      <td className="py-2 pr-4 text-right font-semibold">{format(totals.ash_pct, 1)}</td>
                      <td className="py-2 text-slate-500">% as Fed</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          {/* Nutritional Quality Analysis */}
          <div className="bg-white rounded-2xl shadow p-4 mb-6">
            <div className="flex items-center gap-2 mb-4">
              <BarChart3 className="w-5 h-5 text-sky-600" />
              <h2 className="font-semibold">การวิเคราะห์คุณภาพสารอาหารของสูตร</h2>
            </div>
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
              {(() => {
                let totalNutrients = 0;
                let adequateNutrients = 0;
                let hasDataNutrients = 0;

                Object.entries(reqTable).forEach(([nutr, rows]) => {
                  totalNutrients++;
                  const provided = comparison.provided[nutr];
                  const need = rows[life];

                  if (provided !== null && provided !== undefined && provided > 0) {
                    hasDataNutrients++;
                    if (provided >= need * 0.999) {
                      adequateNutrients++;
                    }
                  }
                });

                const adequacyPercent = hasDataNutrients > 0 ? (adequateNutrients / hasDataNutrients * 100) : 0;
                const dataAvailability = (hasDataNutrients / totalNutrients * 100);

                return (
                  <>
                    <div className="bg-slate-50 rounded-xl p-3">
                      <div className="text-slate-500 text-sm">รวมสารอาหารที่ตรวจสอบ</div>
                      <div className="text-2xl font-bold">{totalNutrients}</div>
                    </div>
                    <div className="bg-slate-50 rounded-xl p-3">
                      <div className="text-slate-500 text-sm">มีข้อมูลครบถ้วน</div>
                      <div className="text-2xl font-bold">{hasDataNutrients}</div>
                      <div className="text-xs text-slate-500">{format(dataAvailability, 1)}%</div>
                    </div>
                    <div className="bg-slate-50 rounded-xl p-3">
                      <div className="text-slate-500 text-sm">จำนวนสารอาหารของสูตรครบตามขั้นต่ำ</div>
                      <div className="text-2xl font-bold text-emerald-600">{adequateNutrients}</div>
                      <div className="text-xs text-slate-500">{format(adequacyPercent, 1)}%</div>
                    </div>
                    <div className="bg-slate-50 rounded-xl p-3">
                      <div className="text-slate-500 text-sm">จำนวนสารอาหารของสูตรต้องปรับปรุง</div>
                      <div className="text-2xl font-bold text-red-600">{hasDataNutrients - adequateNutrients}</div>
                    </div>
                  </>
                );
              })()}
            </div>
          </div>

          {/* Nutritional Analysis - FIXED WITH ALL 12 AMINO ACIDS */}
          <div className="bg-white rounded-2xl shadow p-4 mb-6">
            <div className="flex items-center gap-2">
              <FileSpreadsheet className="w-5 h-5 text-sky-600" />
              <h2 className="font-semibold">สมดุลสารอาหาร vs ข้อกำหนด (AAFCO & FEDIAF Standard) ({unitSystem}, {life})</h2>
            </div>
            <p className="text-xs text-slate-500 mt-1">
              หมายเหตุ: ค่าข้อกำหนดขั้นต่ำตาม FEDIAF 2024 สำหรับสารอาหารหลัก
            </p>
            <div className="mt-4 overflow-x-auto">
              <table className="min-w-full text-sm">
                <thead>
                  <tr className="text-left text-slate-500 border-b">
                    <th className="py-2 pr-3">สารอาหาร</th>
                    <th className="py-2 pr-3">ที่สูตรให้</th>
                    <th className="py-2 pr-3">ข้อกำหนดขั้นต่ำ</th>
                    <th className="py-2 pr-3">สถานะ</th>
                  </tr>
                </thead>
                <tbody>
                  {(() => {
                    // Complete nutrient categories - INCLUDING ALL 12 AMINO ACIDS
                    const nutrientCategories = [
                      {
                        name: "สารอาหารหลัก (Macronutrients)",
                        nutrients: ["Protein", "Fat"]
                      },
                      {
                        name: "กรดไขมันจำเป็น (Essential Fatty Acids)",
                        nutrients: ["Linoleic acid (ω-6)", "Arachidonic acid (ω-6)", "Alpha-linolenic acid (ω-3)", "EPA+DHA (ω-3)"]
                      },
                      {
                        name: "กรดอะมิโนจำเป็น (Essential Amino Acids)",
                        nutrients: [
                          "Arginine", "Histidine", "Isoleucine", "Leucine", "Lysine", 
                          "Methionine", "Methionine + Cystine", "Phenylalanine", 
                          "Phenylalanine + Tyrosine", "Threonine", "Tryptophan", "Valine"
                        ]
                      },
                      {
                        name: "เทารีน (Taurine)",
                        nutrients: ["Taurine"]
                      },
                      {
                        name: "แร่ธาตุหลัก (Major Minerals)",
                        nutrients: ["Calcium", "Phosphorus", "Potassium", "Sodium", "Chloride", "Magnesium"]
                      },
                      {
                        name: "แร่ธาตุรอง (Trace Elements)",
                        nutrients: ["Copper", "Iodine", "Iron", "Manganese", "Selenium", "Zinc"]
                      },
                      {
                        name: "วิตามิน (Vitamins)",
                        nutrients: [
                          "Vitamin A", "Vitamin D", "Vitamin E", 
                          "Thiamine", "Riboflavin", "Niacin", 
                          "Pantothenic", "Pyridoxine", "Biotin", 
                          "Folate", "Cobalamin", "Choline"
                        ]
                      }
                    ];

                    return nutrientCategories.map((category, categoryIndex) => {
                      const categoryRows = [];
                      
                      // Category header
                      categoryRows.push(
                        <tr key={`category-${categoryIndex}`} className="bg-slate-100">
                          <td colSpan="4" className="py-2 px-3 font-semibold text-slate-700 text-sm">
                            {category.name}
                          </td>
                        </tr>
                      );

                      // Category nutrients
                      category.nutrients.forEach((nutr) => {
                        if (!reqTable[nutr]) {
                          console.log(`Missing nutrient in reqTable: ${nutr}`);
                          return; // Skip if nutrient not in requirements table
                        }

                        const rows = reqTable[nutr];
                        const need = rows[life];
                        const provided = (comparison.provided[nutr] ?? null);

                        let status = "insufficient";
                        let statusColor = "bg-red-100 text-red-700";
                        let statusText = "ต่ำกว่าขั้นต่ำ";

                        // Normal nutrient handling
                        if (provided !== null && provided >= need * 0.999) {
                          status = "adequate";
                          statusColor = "bg-emerald-100 text-emerald-700";
                          statusText = "ครบตามขั้นต่ำ";
                        } else if (provided === null || provided === 0) {
                          statusColor = "bg-gray-100 text-gray-700";
                          statusText = "ไม่มีข้อมูล";
                        }

                        categoryRows.push(
                          <tr key={nutr} className="border-b">
                            <td className="py-2 pr-3">
                              <div className="font-medium text-slate-800">{nutr}</div>
                              <div className="text-xs text-slate-500">หน่วย: {rows.unit}{rows.note ? ` • ${rows.note}` : ""}</div>
                            </td>
                            <td className="py-2 pr-3">
                              <span className="font-semibold">
                                {provided !== null && provided > 0 ? format(provided, provided > 5 ? 2 : 3) : "-"}
                              </span>
                            </td>
                            <td className="py-2 pr-3">
                              {format(need, need > 5 ? 2 : 3)}
                            </td>
                            <td className="py-2 pr-3">
                              <span className={`px-2 py-1 rounded-full text-xs ${statusColor}`}>
                                {statusText}
                              </span>
                            </td>
                          </tr>
                        );
                      });

                      return categoryRows;
                    }).flat();
                  })()}
                </tbody>
              </table>
            </div>

            <div className="mt-4 flex flex-wrap gap-4 text-xs">
              <div className="flex items-center gap-2">
                <span className="w-3 h-3 rounded bg-emerald-100 border border-emerald-200"></span>
                <span className="text-emerald-700">ครบตามขั้นต่ำ: เพียงพอตามมาตรฐาน</span>
              </div>
              <div className="flex items-center gap-2">
                <span className="w-3 h-3 rounded bg-red-100 border border-red-200"></span>
                <span className="text-red-700">ต่ำกว่าขั้นต่ำ: ต้องปรับปรุง</span>
              </div>
            </div>
          </div>

          {/* Nutritional Balance Ratios */}
          <div className="bg-white rounded-2xl shadow p-4 mb-6">
            <div className="flex items-center gap-2 mb-4">
              <BarChart3 className="w-5 h-5 text-emerald-600" />
              <h2 className="font-semibold">คุณภาพสมดุลสัดส่วนสารอาหาร (AAFCO & FEDIAF Standard)</h2>
            </div>
            <p className="text-xs text-slate-500 mb-4">
              ตรวจสอบสัดส่วนสารอาหารที่สำคัญเพื่อให้แน่ใจว่าอาหารมีคุณภาพทางโภชนาการที่เหมาะสม
            </p>

            <div className="overflow-x-auto">
              <table className="min-w-full text-sm">
                <thead>
                  <tr className="text-left text-slate-500 border-b">
                    <th className="py-2 pr-3">สัดส่วน</th>
                    <th className="py-2 pr-3">ค่าที่คำนวณได้</th>
                    <th className="py-2 pr-3">ช่วงที่เหมาะสม</th>
                    <th className="py-2 pr-3">มาตรฐาน</th>
                    <th className="py-2 pr-3">สถานะ</th>
                    <th className="py-2">หมายเหตุ</th>
                  </tr>
                </thead>
                <tbody>
                  {(() => {
                    const dmPct = 100 - totals.moisture_pct;
                    const proteinPerME = ME100g > 0 ? (totals.protein_pct * 1000) / ME100g : 0;
                    
                    // Calculate protein/arginine ratio correctly (total protein g per 100g / arginine g per 100g)
                    const proteinArgRatio = totals.Amino.Arginine_g > 0 ? totals.protein_pct / totals.Amino.Arginine_g : 0;
                    
                    const caPRatio = totals.Minerals.Phosphorus_pct > 0 ? totals.Minerals.Calcium_pct / totals.Minerals.Phosphorus_pct : 0;
                    const omega6 = totals.FattyAcids.LinoleicAcid_g + totals.FattyAcids.ArachidonicAcid_g;
                    const omega3 = totals.FattyAcids.AlphaLinolenicAcid_g + totals.FattyAcids.EPADHA_g;
                    const omega6to3 = omega3 > 0 ? omega6 / omega3 : 0;

                    // Calculate ME for display based on unit system
                    const per100gDM_factor = dmPct > 0 ? (100 / dmPct) : 0;
                    const MEValue = unitSystem === "per100gDM" ? ME100g * per100gDM_factor : 1000;

                    const ratios = [
                      {
                        name: "Metabolizable Energy",
                        value: MEValue,
                        unit: unitSystem === "per100gDM" ? "kcal/100g DM" : "kcal/1000 kcal",
                        optimal: unitSystem === "per100gDM" ? "350-450" : "1,000",
                        min: unitSystem === "per100gDM" ? 350 : 1000,
                        max: unitSystem === "per100gDM" ? 450 : 1000,
                        source: "AAFCO/FEDIAF",
                        note: unitSystem === "per100gDM" ? "ช่วงแนะนำสำหรับอาหารแห้ง" : "ตามนิยาม"
                      },
                      {
                        name: "Protein/ME",
                        value: proteinPerME,
                        unit: "g/1000 kcal",
                        optimal: life === "adult" ? "62.5-83.3" : (life === "growth" ? "70.0-75.0" : "75.0"),
                        min: life === "adult" ? 62.5 : (life === "growth" ? 70.0 : 75.0),
                        max: life === "adult" ? 83.3 : (life === "growth" ? 75.0 : 75.0),
                        source: life === "adult" ? "FEDIAF" : (life === "growth" ? "FEDIAF" : "AAFCO"),
                        note: life === "adult" ? "ขึ้นอยู่กับ MER" : "ค่าขั้นต่ำที่แนะนำ"
                      },
                      {
                        name: "Protein/Arginine",
                        value: proteinArgRatio,
                        unit: "g/g",
                        optimal: life === "adult" ? "~25.0" : "~25.3",
                        min: 20,
                        max: 30,
                        source: "FEDIAF",
                        note: life === "adult" ? "คำนวณจากโปรตีน 83.3g และอาร์จินีน 3.3g" : "คำนวณจากโปรตีน 75g และอาร์จินีน 2.78g"
                      },
                      {
                        name: "Ca/P",
                        value: caPRatio,
                        unit: "ratio",
                        optimal: life === "adult" ? "1:1 (max 2:1)" : "1:1 (max 1.5:1)",
                        min: 1.0,
                        max: life === "adult" ? 2.0 : 1.5,
                        source: life === "adult" ? "FEDIAF" : "FEDIAF",
                        note: life === "adult" ? "อัตราส่วนขั้นต่ำ, ค่าสูงสุดทางโภชนาการ 2:1" : "อัตราส่วนขั้นต่ำ, ค่าสูงสุดทางโภชนาการ 1.5:1"
                      },
                      {
                        name: "Omega-6/Omega-3",
                        value: omega6to3,
                        unit: "ratio",
                        optimal: "1-10",
                        min: 1,
                        max: 10,
                        source: "AAFCO/FEDIAF",
                        note: "1-3: ดีมาก, 3-5: ดี, 5-10: พอใช้, >10: ต้องปรับปรุง"
                      }
                    ];

                    return ratios.map((ratio) => {
                      let statusColor, statusText;
                      
                      if (ratio.value === 0) {
                        statusColor = "bg-gray-100 text-gray-700";
                        statusText = "ไม่มีข้อมูล";
                      } else {
                        // Special handling for ME
                        if (ratio.name === "Metabolizable Energy") {
                          if (unitSystem === "per100gDM") {
                            if (ratio.value >= 3500 && ratio.value <= 4500) {
                              statusColor = "bg-emerald-100 text-emerald-700";
                              statusText = "อยู่ในช่วงแนะนำ";
                            } else {
                              statusColor = "bg-yellow-100 text-yellow-700";
                              statusText = "นอกช่วงแนะนำ";
                            }
                          } else {
                            statusColor = "bg-blue-100 text-blue-700";
                            statusText = "ตามนิยาม";
                          }
                        } else if (ratio.name === "Omega-6/Omega-3") {
                          if (ratio.value >= 1 && ratio.value <= 3) {
                            statusColor = "bg-emerald-100 text-emerald-700";
                            statusText = "ดีมาก";
                          } else if (ratio.value > 3 && ratio.value <= 5) {
                            statusColor = "bg-green-100 text-green-700";
                            statusText = "ดี";
                          } else if (ratio.value > 5 && ratio.value <= 10) {
                            statusColor = "bg-yellow-100 text-yellow-700";
                            statusText = "พอใช้";
                          } else {
                            statusColor = "bg-red-100 text-red-700";
                            statusText = "ต้องปรับปรุง";
                          }
                        } else {
                          const isOptimal = ratio.value >= ratio.min && ratio.value <= ratio.max;
                          statusColor = isOptimal ? "bg-emerald-100 text-emerald-700" : "bg-red-100 text-red-700";
                          statusText = isOptimal ? "เหมาะสม" : "ต้องปรับ";
                        }
                      }

                      return (
                        <tr key={ratio.name} className="border-b">
                          <td className="py-2 pr-3">
                            <div className="font-medium text-slate-800">{ratio.name}</div>
                          </td>
                          <td className="py-2 pr-3">
                            <span className="font-semibold">
                              {ratio.value > 0 ? format(ratio.value, ratio.value > 100 ? 0 : 2) : "-"}
                            </span>
                            {ratio.value > 0 && <span className="text-slate-500 ml-1">{ratio.unit}</span>}
                          </td>
                          <td className="py-2 pr-3">
                            <span className="text-slate-600">{ratio.optimal}</span>
                          </td>
                          <td className="py-2 pr-3">
                            <span className={`px-2 py-1 rounded-full text-xs ${ratio.source === 'AAFCO' ? 'bg-blue-100 text-blue-700' : (ratio.source === 'FEDIAF' ? 'bg-purple-100 text-purple-700' : 'bg-indigo-100 text-indigo-700')}`}>
                              {ratio.source}
                            </span>
                          </td>
                          <td className="py-2 pr-3">
                            <span className={`px-2 py-1 rounded-full text-xs ${statusColor}`}>
                              {statusText}
                            </span>
                          </td>
                          <td className="py-2">
                            <span className="text-xs text-slate-500">{ratio.note}</span>
                          </td>
                        </tr>
                      );
                    });
                  })()}
                </tbody>
              </table>
            </div>

            <div className="mt-4 p-3 bg-blue-50 rounded-lg">
              <div className="text-sm text-blue-800">
                <div className="font-medium mb-1">📊 คำแนะนำการใช้ตารางสัดส่วนสารอาหาร:</div>
                <ul className="text-xs space-y-1">
                  <li>• <strong>Protein/ME</strong>: สัดส่วนโปรตีนต่อพลังงาน - ยิ่งสูงยิ่งดีสำหรับแมว (สัตว์กินเนื้อ)</li>
                  <li>• <strong>Protein/Arginine</strong>: อาร์จินีนเป็นกรดอะมิโนจำเป็นสำหรับแมว ต้องมีปริมาณเพียงพอต่อโปรตีน</li>
                  <li>• <strong>Ca/P Ratio</strong>: สมดุลแคลเซียม-ฟอสฟอรัส สำคัญต่อกระดูกและฟัน ต้องไม่เกินอัตราส่วนสูงสุด</li>
                  <li>• <strong>Omega-6/Omega-3</strong>: สมดุลกรดไขมันจำเป็น ช่วยลดการอักเสบและเสริมสร้างภูมิคุ้มกัน</li>
                  <li>• <strong>ความแตกต่างตามช่วงวัย</strong>: ลูกแมวและแมวท้องต้องการสัดส่วนที่แตกต่างจากแมวโตเต็มวัย</li>
                  <li>• <strong>มาตรฐานอ้างอิง</strong>: AAFCO (สหรัฐฯ), FEDIAF (ยุโรป) - ข้อมูลอัปเดตล่าสุด 2024</li>
                </ul>
              </div>
            </div>
          </div>

          {/* Safety Check Table */}
          <div className="bg-white rounded-2xl shadow p-4">
            <div className="flex items-center gap-2 mb-4">
              <Info className="w-5 h-5 text-orange-600" />
              <h2 className="font-semibold">ตรวจสอบความปลอดภัยของสูตรอาหาร (AAFCO & FEDIAF Standard)</h2>
            </div>
            <p className="text-xs text-slate-500 mb-4">
              ตรวจสอบค่าขีดสูงสุดที่ปลอดภัย เพื่อป้องกันการเป็นพิษจากสารอาหารส่วนเกิน
            </p>

            <div className="overflow-x-auto">
              <table className="min-w-full text-sm">
                <thead>
                  <tr className="text-left text-slate-500 border-b">
                    <th className="py-2 pr-3">สารอาหาร</th>
                    <th className="py-2 pr-3">ค่าที่คำนวณได้</th>
                    <th className="py-2 pr-3">ขีดสูงสุดปลอดภัย</th>
                    <th className="py-2 pr-3">มาตรฐาน</th>
                    <th className="py-2 pr-3">สถานะ</th>
                    <th className="py-2">ความเสี่ยง</th>
                  </tr>
                </thead>
                <tbody>
                  {(() => {
                    const dmPct = 100 - totals.moisture_pct;
                    const per100gDM_factor = dmPct > 0 ? (100 / dmPct) : 0;
                    const caPRatio = totals.Minerals.Phosphorus_pct > 0 ? totals.Minerals.Calcium_pct / totals.Minerals.Phosphorus_pct : 0;

                    // Safety limits from AAFCO & FEDIAF standards (Updated 2024)
                    const safetyChecks = [
                      {
                        name: "Methionine",
                        value: totals.Amino.Methionine_g * per100gDM_factor,
                        unit: "g/100g DM",
                        limit: 1.5, // AAFCO limit (both adult and growth/repro)
                        risk: "ความเสียหายต่อตับและไต",
                        source: "AAFCO"
                      },
                      {
                        name: "Tryptophan",
                        value: totals.Amino.Tryptophan_g * per100gDM_factor,
                        unit: "g/100g DM",
                        limit: 1.7, // AAFCO limit (both adult and growth/repro)
                        risk: "ผลกระทบต่อระบบประสาท",
                        source: "AAFCO"
                      },
                      {
                        name: "Arginine",
                        value: totals.Amino.Arginine_g * per100gDM_factor,
                        unit: "g/100g DM",
                        limit: 3.5, // FEDIAF limit for growth (nutritional maximum)
                        risk: "ความไม่สมดุลกรดอะมิโน",
                        source: "FEDIAF"
                      },
                      {
                        name: "Ca/P Ratio",
                        value: caPRatio,
                        unit: "ratio",
                        limit: life === "adult" ? 2.0 : 1.5, // FEDIAF: Adult 2/1, Growth/Repro 1.5/1
                        risk: "ความไม่สมดุลแร่ธาตุ",
                        source: "FEDIAF"
                      },
                      {
                        name: "Copper",
                        value: totals.Minerals.Copper_mg * per100gDM_factor, // Direct conversion to mg/100g DM
                        unit: "mg/100g DM",
                        limit: 2.8, // FEDIAF legal maximum (updated from calculation error)
                        risk: "การสะสมทองแดงในตับ",
                        source: "FEDIAF"
                      },
                      {
                        name: "Iodine",
                        value: totals.Minerals.Iodine_mg * per100gDM_factor, // Direct conversion to mg/100g DM
                        unit: "mg/100g DM",
                        limit: 1.10, // FEDIAF legal maximum
                        risk: "ความผิดปกติของต่อมไทรอยด์",
                        source: "FEDIAF"
                      },
                      {
                        name: "Iron",
                        value: totals.Minerals.Iron_mg * per100gDM_factor, // Direct conversion to mg/100g DM
                        unit: "mg/100g DM",
                        limit: 68.18, // FEDIAF legal maximum (corrected from previous calculation)
                        risk: "การสะสมเหล็กในตับ",
                        source: "FEDIAF"
                      },
                      {
                        name: "Manganese",
                        value: totals.Minerals.Manganese_mg * per100gDM_factor, // Direct conversion to mg/100g DM
                        unit: "mg/100g DM",
                        limit: 17.0, // FEDIAF legal maximum (corrected from previous calculation)
                        risk: "ความเป็นพิษต่อระบบประสาท",
                        source: "FEDIAF"
                      },
                      {
                        name: "Selenium",
                        value: totals.Minerals.Selenium_mg * per100gDM_factor / 1000, // Convert to mcg/100g DM
                        unit: "mcg/100g DM",
                        limit: 56.80, // FEDIAF legal maximum: 56.8 mcg/100g DM (corrected unit)
                        risk: "ซีลีเนียมเป็นพิษ",
                        source: "FEDIAF"
                      },
                      {
                        name: "Zinc",
                        value: totals.Minerals.Zinc_mg * per100gDM_factor, // Direct conversion to mg/100g DM
                        unit: "mg/100g DM",
                        limit: 22.7, // FEDIAF legal maximum (corrected from previous calculation)
                        risk: "การรบกวนการดูดซึมแร่ธาตุอื่น",
                        source: "FEDIAF"
                      },
                      {
                        name: "Vitamin A",
                        value: totals.Vitamins.VitaminA_IU * per100gDM_factor / 10, // Convert to IU/100g DM
                        unit: "IU/100g DM",
                        limit: life === "adult" ? 40000 : 40000, // FEDIAF nutritional maximum (more conservative than AAFCO 33330)
                        risk: "วิตามินเอ เป็นพิษ",
                        source: "FEDIAF"
                      },
                      {
                        name: "Vitamin D",
                        value: totals.Vitamins.VitaminD_IU * per100gDM_factor / 10, // Convert to IU/100g DM
                        unit: "IU/100g DM",
                        limit: life === "adult" ? 227 : 227, // FEDIAF legal maximum (more restrictive than AAFCO)
                        risk: "การสะสมแคลเซียมผิดปกติ",
                        source: "FEDIAF"
                      }
                    ];

                    return safetyChecks.map((check) => {
                      const isOverLimit = check.value > check.limit;
                      const statusColor = isOverLimit ? "bg-red-100 text-red-700" : "bg-emerald-100 text-emerald-700";
                      const statusText = isOverLimit ? "เกินขีดสูงสุด" : "ปลอดภัย";

                      return (
                        <tr key={check.name} className="border-b">
                          <td className="py-2 pr-3">
                            <div className="font-medium text-slate-800">{check.name}</div>
                          </td>
                          <td className="py-2 pr-3">
                            <span className={`font-semibold ${isOverLimit ? "text-red-600" : ""}`}>
                              {check.value > 0 ? format(check.value, check.value > 100 ? 0 : 2) : "-"}
                            </span>
                            {check.value > 0 && <span className="text-slate-500 ml-1">{check.unit}</span>}
                          </td>
                          <td className="py-2 pr-3">
                            <span className="text-slate-600">{"<"}{format(check.limit, check.limit > 100 ? 0 : 2)} {check.unit}</span>
                          </td>
                          <td className="py-2 pr-3">
                            <span className={`px-2 py-1 rounded-full text-xs ${check.source === 'AAFCO' ? 'bg-blue-100 text-blue-700' : 'bg-purple-100 text-purple-700'}`}>
                              {check.source}
                            </span>
                          </td>
                          <td className="py-2 pr-3">
                            <span className={`px-2 py-1 rounded-full text-xs ${statusColor}`}>
                              {statusText}
                            </span>
                          </td>
                          <td className="py-2">
                            <span className="text-xs text-slate-500">{check.risk}</span>
                          </td>
                        </tr>
                      );
                    });
                  })()}
                </tbody>
              </table>
            </div>

            <div className="mt-4 p-3 bg-red-50 rounded-lg">
              <div className="text-sm text-red-800">
                <div className="font-medium mb-1">⚠️ คำเตือนความปลอดภัย (AAFCO & FEDIAF Standards):</div>
                <ul className="text-xs space-y-1">
                  <li>• <strong>สารอาหารเกินขีดสูงสุด</strong>: อาจทำให้เกิดการเป็นพิษ ควรปรับสูตรทันที</li>
                  <li>• <strong>ข้อกำหนดตามช่วงชีวิต</strong>: อัตราส่วน Ca/P แตกต่างกันตามช่วงวัย (Adult: &lt;2:1, Growth/Repro: &lt;1.5:1)</li>
                  <li>• <strong>กรดอะมิโนเกิน</strong>: Methionine และ Tryptophan เกินขีดอาจส่งผลต่อระบบประสาทและตับ</li>
                  <li>• <strong>แร่ธาตุเกิน</strong>: Cu, Zn, Fe, Mn, I, Se เกินขีดอาจสะสมและเป็นพิษเรื้อรัง</li>
                  <li>• <strong>วิตามินไขมันละลาย</strong>: Vitamin A, D เกินขีดสะสมในร่างกายและเป็นพิษได้</li>
                  <li>• <strong>มาตรฐานอ้างอิง</strong>: AAFCO (สหรัฐฯ) และ FEDIAF (ยุโรป) - ใช้ข้อมูลล่าสุดจากทั้งสองมาตรฐาน</li>
                  <li>• <strong>ข้อแนะนำ</strong>: ปรับสูตรให้อยู่ในช่วงปลอดภัยก่อนการผลิตเชิงพาณิชย์</li>
                </ul>
              </div>
            </div>
          </div>
        </section>
      </main>

      {/* Ingredient Editor Modal */}
      <IngredientEditorModal
        ingredient={editingIngredient}
        isOpen={showEditor}
        onClose={() => setShowEditor(false)}
        onSave={saveIngredient}
      />

      <footer className="max-w-7xl mx-auto px-4 py-8 text-xs text-slate-500">
        <p>
          © {new Date().getFullYear()} Feline Complete & Balance Food Formulator. เครื่องมือนี้อ้างอิง AAFCO & FEDIAF Nutritional Standards สำหรับแมว
          ควรตรวจสอบด้วยการวิเคราะห์ในห้องปฏิบัติการก่อนการผลิตเชิงพาณิชย์
        </p>
      </footer>
    </div>
  );
}